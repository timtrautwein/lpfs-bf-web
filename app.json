[{"name":"app.R","content":"# LPFS-BF 2.0 - REPARIERTE MINIMALE VERSION\r\n# Funktioniert garantiert - nur shiny, keine anderen Pakete!\r\n\r\nlibrary(shiny)\r\n\r\n# LPFS-BF Items\r\nitems <- c(\r\n  \"Ich weiÃŸ oft nicht wer ich wirklich bin.\",\r\n  \"Ich denke oft sehr schlecht Ã¼ber mich selbst.\",\r\n  \"Meine GefÃ¼hle Ã¤ndern sich, ohne dass ich sie im Griff habe.\",\r\n  \"Ich habe keine Ahnung, wo ich im Leben hin will.\",\r\n  \"Ich verstehe oft meine eigenen Gedanken und GefÃ¼hle nicht.\",\r\n  \"Ich stelle oft unrealistische Anforderungen an mich selbst.\",\r\n  \"Ich habe oft Schwierigkeiten, die Gedanken und GefÃ¼hle anderer zu verstehen.\",\r\n  \"Ich kann es oft schwer aushalten, wenn andere eine andere Meinung haben.\",\r\n  \"Ich verstehe oft nicht ganz, warum mein Verhalten einen bestimmten Einfluss auf andere hat.\",\r\n  \"Meine Beziehungen und Freundschaften halten nie lange.\",\r\n  \"Ich fÃ¼hle mich oft sehr verletzlich, wenn Beziehungen persÃ¶nlicher werden.\",\r\n  \"Es gelingt mir hÃ¤ufig nicht, mit anderen auf eine Weise zusammen zu arbeiten, die fÃ¼r beide Seiten zufriedenstellend ist.\"\r\n)\r\n\r\n# T-Werte zu Perzentil Konvertierung - KONTINUIERLICH & PRÃ„ZISE\r\ncalculate_percentile <- function(score) {\r\n  t_values <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n  names(t_values) <- 12:48\r\n  \r\n  if (score < 12) return(1)\r\n  if (score > 48) return(99)\r\n  \r\n  t_val <- t_values[as.character(score)]\r\n  if (is.na(t_val)) t_val <- 50\r\n  \r\n  # Kontinuierliche Normalverteilungs-CDF Approximation\r\n  # T-Werte: T = 50 + 10*z, also z = (T-50)/10\r\n  z_score <- (t_val - 50) / 10\r\n  \r\n  # Begrenzen auf sinnvolle Werte\r\n  z_score <- pmax(-3, pmin(3, z_score))\r\n  \r\n  # PrÃ¤zise Approximation der Standard-Normalverteilung CDF\r\n  # Abramowitz & Stegun Approximation (sehr genau)\r\n  if (z_score >= 0) {\r\n    # FÃ¼r positive z-scores\r\n    t <- 1 / (1 + 0.2316419 * z_score)\r\n    d <- 0.3989423 * exp(-z_score * z_score / 2)\r\n    prob <- 1 - d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  } else {\r\n    # FÃ¼r negative z-scores: Î¦(-z) = 1 - Î¦(z)\r\n    z_pos <- -z_score\r\n    t <- 1 / (1 + 0.2316419 * z_pos)\r\n    d <- 0.3989423 * exp(-z_pos * z_pos / 2)\r\n    prob <- d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  }\r\n  \r\n  # Konvertiere zu Perzentil (0-100)\r\n  percentile <- round(prob * 100)\r\n  \r\n  # Sicherstellen dass Werte im sinnvollen Bereich sind\r\n  return(pmax(1, pmin(99, percentile)))\r\n}\r\n\r\n# UI - Nur mit Shiny, kein bslib\r\nui <- fluidPage(\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8f9fa; }\r\n      .container-fluid { max-width: 1000px; margin: 0 auto; padding: 20px; }\r\n      .panel { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }\r\n      .question-item { background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin: 15px 0; transition: all 0.3s ease; }\r\n      .question-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }\r\n      .self-section { border-left: 4px solid #007bff; }\r\n      .interpersonal-section { border-left: 4px solid #28a745; }\r\n      .results-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; }\r\n      .score-card { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 20px; margin: 10px; text-align: center; backdrop-filter: blur(10px); }\r\n      .score-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }\r\n      .score-label { font-size: 1.1em; opacity: 0.9; }\r\n      .btn-primary { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }\r\n      .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,123,255,0.3); }\r\n      .btn-secondary { background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }\r\n      .interpretation-panel { background: white; color: #333; border-radius: 12px; padding: 25px; margin: 20px 0; }\r\n      .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }\r\n      .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }\r\n      .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }\r\n      .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }\r\n      .alert-danger { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }\r\n      .norm-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\r\n      .norm-item { padding: 20px; border-radius: 10px; text-align: center; color: white; font-weight: bold; position: relative; }\r\n      .norm-good { background: linear-gradient(135deg, #28a745, #20c997); }\r\n      .norm-average { background: linear-gradient(135deg, #17a2b8, #20c997); }\r\n      .norm-elevated { background: linear-gradient(135deg, #ffc107, #fd7e14); color: #333; }\r\n      .norm-high { background: linear-gradient(135deg, #dc3545, #e83e8c); }\r\n      .your-score { background: #007bff; color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; font-size: 1.2em; font-weight: bold; }\r\n      h1, h2, h3, h4 { color: #2c3e50; margin-bottom: 15px; }\r\n      .section-title { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 8px; margin-bottom: 20px; }\r\n      .radio-option { margin: 8px 0; }\r\n      @media (max-width: 768px) {\r\n        .container-fluid { padding: 10px; }\r\n        .panel { padding: 15px; margin: 10px 0; }\r\n        .score-number { font-size: 2em; }\r\n        .norm-comparison { grid-template-columns: 1fr 1fr; }\r\n      }\r\n    \"))\r\n  ),\r\n  \r\n  title = \"LPFS-BF 2.0\",\r\n  \r\n  # Header\r\n  div(class = \"panel\",\r\n      h1(\"ðŸ‘¥ LPFS-BF 2.0\", style = \"text-align: center; color: #007bff; margin-bottom: 10px;\"),\r\n      h3(\"Level of Personality Functioning Scale\", style = \"text-align: center; color: #6c757d; font-weight: 300;\"),\r\n      hr(),\r\n      p(\"Diese validierte Skala erfasst das Funktionsniveau der PersÃ¶nlichkeit in zwei Hauptbereichen:\", \r\n        style = \"text-align: center; font-size: 1.1em; color: #666;\"),\r\n      div(style = \"text-align: center; margin: 20px 0;\",\r\n          span(\"ðŸ§â€â™‚ï¸ Selbst-Funktionen (Items 1-6)\", style = \"margin: 0 20px; color: #007bff; font-weight: 500;\"),\r\n          span(\"ðŸ‘¥ Interpersonale Funktionen (Items 7-12)\", style = \"margin: 0 20px; color: #28a745; font-weight: 500;\")\r\n      )\r\n  ),\r\n  \r\n  # Fragebogen\r\n  conditionalPanel(\r\n    condition = \"!output.show_results\",\r\n    div(class = \"panel\",\r\n        h3(\"Fragebogen\", class = \"section-title\"),\r\n        p(\"Bitte geben Sie fÃ¼r jede der folgenden Aussagen an, inwieweit diese zurzeit auf Sie zutrifft:\", \r\n          style = \"font-size: 1.1em; margin-bottom: 30px;\"),\r\n        \r\n        h4(\"ðŸ§â€â™‚ï¸ Selbst-Bereich\", style = \"color: #007bff; margin-top: 30px;\"),\r\n        lapply(1:6, function(i) {\r\n          div(class = \"question-item self-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        h4(\"ðŸ‘¥ Interpersonaler Bereich\", style = \"color: #28a745; margin-top: 40px;\"),\r\n        lapply(7:12, function(i) {\r\n          div(class = \"question-item interpersonal-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        div(style = \"text-align: center; margin: 40px 0;\",\r\n            actionButton(\"calculate\", \"ðŸŽ¯ Ergebnisse berechnen\", class = \"btn-primary\", style = \"width: 300px; height: 55px; font-size: 18px;\")\r\n        )\r\n    )\r\n  ),\r\n  \r\n  # Ergebnisse\r\n  conditionalPanel(\r\n    condition = \"output.show_results\",\r\n    \r\n    # Score Cards\r\n    div(class = \"results-container\",\r\n        h2(\"ðŸ§â€â™‚ï¸ Ihre Ergebnisse\", style = \"text-align: center; margin-bottom: 30px;\"),\r\n        fluidRow(\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"total_score\")),\r\n                        div(class = \"score-label\", \"Gesamtwert (12-48)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"self_score\")),\r\n                        div(class = \"score-label\", \"Selbst-Bereich (6-24)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"interpersonal_score\")),\r\n                        div(class = \"score-label\", \"Interpersonal (6-24)\")\r\n          ))\r\n        ),\r\n        \r\n        # Perzentil\r\n        div(class = \"score-card\", style = \"margin-top: 20px;\",\r\n            div(style = \"font-size: 3em; font-weight: bold;\", \r\n                textOutput(\"percentile\", inline = TRUE), \r\n                span(\"%\", style = \"color: #ffd700;\")\r\n            ),\r\n            div(class = \"score-label\", \"Perzentil in der deutschen BevÃ¶lkerung\"),\r\n            div(style = \"margin-top: 10px; font-size: 1.1em;\",\r\n                \"T-Wert: \", textOutput(\"t_value\", inline = TRUE)\r\n            )\r\n        )\r\n    ),\r\n    \r\n    # Interpretation\r\n    div(class = \"interpretation-panel\",\r\n        h3(\"ðŸ§â€â™€ï¸ Interpretation\", class = \"section-title\"),\r\n        uiOutput(\"interpretation\")\r\n    ),\r\n    \r\n    # Normvergleich mit Normalverteilungs-Dichtefunktion\r\n    div(class = \"panel\",\r\n        h3(\"ðŸ“Š Normvergleich\", class = \"section-title\"),\r\n        p(\"Ihre Position in der deutschen AllgemeinbevÃ¶lkerung (realer T-Wert-Bereich: 45-82):\", \r\n          style = \"margin-bottom: 15px;\"),\r\n        p(tags$em(\"Spitzer et al., 2021, n=2.470 â€¢ Nicht-klinische Stichprobe\"), \r\n          style = \"margin-bottom: 25px; color: #666; font-size: 0.9em;\"),\r\n        \r\n        # Normalverteilungsdiagramm mit vielen schmalen Balken\r\n        div(style = \"position: relative; height: 250px; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); border-radius: 10px; margin: 30px 0; padding: 20px; overflow: hidden;\",\r\n            \r\n            # JavaScript fÃ¼r dynamische Balkenerstellung (wird im Server generiert)\r\n            uiOutput(\"normal_distribution_bars\"),\r\n            \r\n            # Ihr Wert als roter Strich (wird dynamisch positioniert)\r\n            uiOutput(\"user_position_marker\"),\r\n            \r\n            # X-Achsen-Beschriftung (angepasst fÃ¼r realen T-Wert Bereich)\r\n            div(style = \"position: absolute; bottom: 5px; left: 50px; font-size: 12px; color: #666;\", \"T=45\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 150px; font-size: 12px; color: #666;\", \"T=55\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 250px; font-size: 12px; color: #666;\", \"T=65\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 350px; font-size: 12px; color: #666;\", \"T=75\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 450px; font-size: 12px; color: #666;\", \"T=82\"),\r\n            \r\n            # Hinweis auf Minimum\r\n            div(style = \"position: absolute; top: 10px; left: 50px; font-size: 11px; color: #28a745; font-weight: bold;\", \"MINIMUM\"),\r\n        ),\r\n        \r\n        # Legende (aktualisiert fÃ¼r realen T-Wert Bereich)\r\n        div(style = \"margin-top: 20px; text-align: center;\",\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #28a745; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"BestmÃ¶glich (T=45)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #17a2b8; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Durchschnitt (T46-55)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #ffc107; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"ErhÃ¶ht (T56-69)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #dc3545; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Hoch (Tâ‰¥70)\", style = \"font-size: 14px;\")\r\n            )\r\n        ),\r\n        \r\n        div(class = \"your-score\",\r\n            \"ðŸŽ¯ Ihr Wert: \", textOutput(\"your_position\", inline = TRUE)\r\n        )\r\n    ),\r\n    \r\n    div(style = \"text-align: center; margin: 30px 0;\",\r\n        actionButton(\"reset\", \"ðŸ”„ Neue Umfrage starten\", class = \"btn-secondary\")\r\n    )\r\n  )\r\n)\r\n\r\n# Server\r\nserver <- function(input, output, session) {\r\n  values <- reactiveValues(calculated = FALSE)\r\n  \r\n  observeEvent(input$calculate, {\r\n    # Sammle alle Antworten\r\n    all_items <- sapply(1:12, function(i) input[[paste0(\"item_\", i)]])\r\n    \r\n    # PrÃ¼fe ob alle beantwortet\r\n    if (any(sapply(all_items, is.null))) {\r\n      showNotification(\"ðŸ§â€â™‚ï¸ Bitte beantworten Sie alle 12 Fragen!\", type = \"warning\")\r\n      return()\r\n    }\r\n    \r\n    # Berechne Scores\r\n    scores <- as.numeric(all_items)\r\n    values$self_score <- sum(scores[1:6])\r\n    values$interpersonal_score <- sum(scores[7:12])\r\n    values$total_score <- values$self_score + values$interpersonal_score\r\n    values$percentile <- calculate_percentile(values$total_score)\r\n    \r\n    # T-Wert aus Tabelle\r\n    t_vals <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n    names(t_vals) <- 12:48\r\n    values$t_value <- t_vals[as.character(values$total_score)]\r\n    if (is.na(values$t_value)) values$t_value <- 50\r\n    \r\n    values$calculated <- TRUE\r\n    showNotification(\"ðŸŽ¯ Ergebnisse erfolgreich berechnet!\", type = \"message\")\r\n  })\r\n  \r\n  observeEvent(input$reset, {\r\n    # Alle Inputs zurÃ¼cksetzen\r\n    lapply(1:12, function(i) {\r\n      updateRadioButtons(session, paste0(\"item_\", i), selected = character(0))\r\n    })\r\n    values$calculated <- FALSE\r\n    showNotification(\"ðŸ‘¥ Fragebogen wurde zurÃ¼ckgesetzt\", type = \"message\")\r\n  })\r\n  \r\n  # Outputs\r\n  output$show_results <- reactive({ values$calculated })\r\n  outputOptions(output, \"show_results\", suspendWhenHidden = FALSE)\r\n  \r\n  output$total_score <- renderText({\r\n    if (values$calculated) as.character(values$total_score) else \"\"\r\n  })\r\n  \r\n  output$self_score <- renderText({\r\n    if (values$calculated) as.character(values$self_score) else \"\"\r\n  })\r\n  \r\n  output$interpersonal_score <- renderText({\r\n    if (values$calculated) as.character(values$interpersonal_score) else \"\"\r\n  })\r\n  \r\n  output$percentile <- renderText({\r\n    if (values$calculated) as.character(values$percentile) else \"\"\r\n  })\r\n  \r\n  output$t_value <- renderText({\r\n    if (values$calculated) as.character(values$t_value) else \"\"\r\n  })\r\n  \r\n  output$interpretation <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    percentile <- values$percentile\r\n    t_val <- values$t_value\r\n    \r\n    # Interpretation basierend auf Perzentilen - MIT METHODISCHEN HINWEISEN\r\n    if (percentile <= 31) {\r\n      alert_class <- \"alert-success\"\r\n      level <- \"ðŸ§â€â™‚ï¸ Gutes Funktionsniveau\"\r\n      if (score == 12) {\r\n        desc <- paste0(\"Sie haben das bestmÃ¶gliche Ergebnis erreicht (\", score, \" Punkte, T-Wert: \", t_val, \"). Dies ist der niedrigstmÃ¶gliche Wert und deutet auf ein ausgezeichnetes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      } else {\r\n        desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf ein gutes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      }\r\n    } else if (percentile <= 69) {\r\n      alert_class <- \"alert-info\"\r\n      level <- \"ðŸ‘¤ Durchschnittliches Funktionsniveau\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und entspricht dem durchschnittlichen Bereich der AllgemeinbevÃ¶lkerung.\")\r\n    } else if (percentile <= 93) {\r\n      alert_class <- \"alert-warning\"\r\n      level <- \"ðŸš¶â€â™‚ï¸ Leicht erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und kÃ¶nnte auf leichte Schwierigkeiten im Funktionsniveau hinweisen.\")\r\n    } else {\r\n      alert_class <- \"alert-danger\"\r\n      level <- \"ðŸ§â€â™€ï¸ Deutlich erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf bedeutsame Schwierigkeiten im Funktionsniveau hin.\")\r\n    }\r\n    \r\n    tagList(\r\n      div(class = paste(\"alert\", alert_class),\r\n          h4(level, style = \"margin-bottom: 15px;\"),\r\n          p(desc, style = \"margin-bottom: 0; font-size: 1.05em;\")\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      fluidRow(\r\n        column(6,\r\n               h5(\"ðŸ“‹ Referenzwerte:\"),\r\n               tags$ul(\r\n                 tags$li(\"Tâ‚…â‚€ = 15 Punkte (Durchschnitt)\"),\r\n                 tags$li(\"Tâ‚‡â‚€ = 33 Punkte (klinisch auffÃ¤llig)\")\r\n               )\r\n        ),\r\n        column(6,\r\n               h5(\"ðŸ§â€â™‚ï¸ Ihre Werte:\"),\r\n               tags$ul(\r\n                 tags$li(paste0(\"Selbst-Bereich: \", values$self_score, \"/24\")),\r\n                 tags$li(paste0(\"Interpersonal: \", values$interpersonal_score, \"/24\")),\r\n                 tags$li(paste0(\"Gesamt: \", score, \"/48\"))\r\n               )\r\n        )\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ“Š Methodischer Hinweis: \"), \r\n            \"Die LPFS-BF hat einen Mindestwert von 12 Punkten (bestmÃ¶gliches Ergebnis). Niemand kann niedrigere Werte erreichen. Das bedeutet, dass bei niedrigen Perzentilen nicht alle Prozentangaben unterhalb Ihres Werts liegen, sondern das die Normierung auf der gesamten theoretischen Verteilung basiert. Diese Studie wurde an einer nicht-klinischen Stichprobe durchgefÃ¼hrt.\",\r\n            style = \"margin: 0; color: #6c757d; font-size: 0.9em;\")\r\n      ),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ§â€â™€ï¸ Wichtiger Hinweis: \"), \r\n            \"Diese Auswertung dient ausschlieÃŸlich zu Informations- und Bildungszwecken. Sie ersetzt keine professionelle psychologische Diagnostik oder Beratung. Bei anhaltenden Problemen wenden Sie sich an qualifizierte FachkrÃ¤fte.\",\r\n            style = \"margin: 0; color: #6c757d;\")\r\n      ),\r\n      \r\n      div(style = \"text-align: center; margin-top: 20px;\",\r\n          tags$em(\"Referenz: Spitzer, C. et al. (2021). Psychotherapie - Psychosomatik - Medizinische Psychologie, 71, 284-293.\",\r\n                  style = \"color: #6c757d; font-size: 0.9em;\")\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$your_position <- renderText({\r\n    if (values$calculated) {\r\n      paste0(values$total_score, \" Punkte (T-Wert: \", values$t_value, \")\")\r\n    } else \"\"\r\n  })\r\n  \r\n  # Normalverteilungsbalken generieren - KORRIGIERT fÃ¼r realen T-Wert Bereich (45-82)\r\n  output$normal_distribution_bars <- renderUI({\r\n    # T-Werte von 45 bis 80 (realer Bereich laut Tabelle), alle 2er Schritte\r\n    # T=45 ist MINIMUM (12 Punkte), T=82 ist MAXIMUM (48 Punkte)\r\n    t_values <- seq(45, 79, by = 2)\r\n    \r\n    # Vordefinierte normalisierte HÃ¶hen fÃ¼r T=45-79 (basiert auf dnorm, dann skaliert)\r\n    # Peak bei T=50, abfallend zu den Seiten\r\n    heights <- c(\r\n      69, 80, 92, 105, 117, 129, 139, 148, 150, 148, 139, 129, 117, 105, 92, 80, 69, 55\r\n    )\r\n    \r\n    # Erstelle Balken\r\n    bars <- lapply(1:length(t_values), function(i) {\r\n      t_val <- t_values[i]\r\n      height <- heights[i]\r\n      \r\n      # Bestimme Farbe basierend auf T-Wert-Bereich\r\n      if (t_val <= 45) {\r\n        color <- \"#28a745\"  # GrÃ¼n\r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 55) {\r\n        color <- \"#17a2b8\"  # Blau  \r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 69) {\r\n        color <- \"#ffc107\"  # Gelb\r\n        opacity <- \"0.8\"\r\n      } else {\r\n        color <- \"#dc3545\"  # Rot\r\n        opacity <- \"0.8\"\r\n      }\r\n      \r\n      # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n      position <- 50 + ((t_val - 45) / 34) * 400\r\n      \r\n      div(style = paste0(\r\n        \"position: absolute; \",\r\n        \"left: \", position, \"px; \",\r\n        \"bottom: 25px; \",\r\n        \"width: 15px; \",\r\n        \"height: \", height, \"px; \",\r\n        \"background: \", color, \"; \",\r\n        \"border-radius: 2px 2px 0 0; \",\r\n        \"opacity: \", opacity, \"; \",\r\n        \"transition: all 0.3s ease;\"\r\n      ))\r\n    })\r\n    \r\n    return(tagList(bars))\r\n  })\r\n  \r\n  # Dynamische Positionierung des Benutzerwerts im Verteilungsdiagramm\r\n  output$user_position_marker <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    t_val <- values$t_value\r\n    \r\n    # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n    position <- 50 + ((t_val - 45) / 34) * 400\r\n    \r\n    # Begrenze Position auf sichtbare Bereiche\r\n    position <- max(50, min(450, position))\r\n    \r\n    tagList(\r\n      # Roter Strich\r\n      div(style = paste0(\"position: absolute; left: \", position, \"px; top: 10px; width: 4px; height: 180px; background: #ff0000; border-radius: 2px; box-shadow: 0 0 10px rgba(255,0,0,0.7); z-index: 10;\")),\r\n      # Pfeil nach unten\r\n      div(style = paste0(\"position: absolute; left: \", position-5, \"px; top: 185px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid #ff0000; z-index: 10;\")),\r\n      # Label\r\n      div(style = paste0(\"position: absolute; left: \", position-25, \"px; top: 200px; background: #ff0000; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap; z-index: 10;\"),\r\n          paste0(score, \" Pkt (T\", t_val, \")\")\r\n      )\r\n    )\r\n  })\r\n}\r\n\r\n# App starten\r\nshinyApp(ui = ui, server = server)","type":"text"},{"name":"Archive/app.R","content":"# LPFS-BF 2.0 - REPARIERTE MINIMALE VERSION\r\n# Funktioniert garantiert - nur shiny, keine anderen Pakete!\r\n\r\nlibrary(shiny)\r\n\r\n# LPFS-BF Items\r\nitems <- c(\r\n  \"Ich weiÃŸ oft nicht wer ich wirklich bin.\",\r\n  \"Ich denke oft sehr schlecht Ã¼ber mich selbst.\",\r\n  \"Meine GefÃ¼hle Ã¤ndern sich, ohne dass ich sie im Griff habe.\",\r\n  \"Ich habe keine Ahnung, wo ich im Leben hin will.\",\r\n  \"Ich verstehe oft meine eigenen Gedanken und GefÃ¼hle nicht.\",\r\n  \"Ich stelle oft unrealistische Anforderungen an mich selbst.\",\r\n  \"Ich habe oft Schwierigkeiten, die Gedanken und GefÃ¼hle anderer zu verstehen.\",\r\n  \"Ich kann es oft schwer aushalten, wenn andere eine andere Meinung haben.\",\r\n  \"Ich verstehe oft nicht ganz, warum mein Verhalten einen bestimmten Einfluss auf andere hat.\",\r\n  \"Meine Beziehungen und Freundschaften halten nie lange.\",\r\n  \"Ich fÃ¼hle mich oft sehr verletzlich, wenn Beziehungen persÃ¶nlicher werden.\",\r\n  \"Es gelingt mir hÃ¤ufig nicht, mit anderen auf eine Weise zusammen zu arbeiten, die fÃ¼r beide Seiten zufriedenstellend ist.\"\r\n)\r\n\r\n# T-Werte zu Perzentil Konvertierung - KONTINUIERLICH & PRÃ„ZISE\r\ncalculate_percentile <- function(score) {\r\n  t_values <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n  names(t_values) <- 12:48\r\n  \r\n  if (score < 12) return(1)\r\n  if (score > 48) return(99)\r\n  \r\n  t_val <- t_values[as.character(score)]\r\n  if (is.na(t_val)) t_val <- 50\r\n  \r\n  # Kontinuierliche Normalverteilungs-CDF Approximation\r\n  # T-Werte: T = 50 + 10*z, also z = (T-50)/10\r\n  z_score <- (t_val - 50) / 10\r\n  \r\n  # Begrenzen auf sinnvolle Werte\r\n  z_score <- pmax(-3, pmin(3, z_score))\r\n  \r\n  # PrÃ¤zise Approximation der Standard-Normalverteilung CDF\r\n  # Abramowitz & Stegun Approximation (sehr genau)\r\n  if (z_score >= 0) {\r\n    # FÃ¼r positive z-scores\r\n    t <- 1 / (1 + 0.2316419 * z_score)\r\n    d <- 0.3989423 * exp(-z_score * z_score / 2)\r\n    prob <- 1 - d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  } else {\r\n    # FÃ¼r negative z-scores: Î¦(-z) = 1 - Î¦(z)\r\n    z_pos <- -z_score\r\n    t <- 1 / (1 + 0.2316419 * z_pos)\r\n    d <- 0.3989423 * exp(-z_pos * z_pos / 2)\r\n    prob <- d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  }\r\n  \r\n  # Konvertiere zu Perzentil (0-100)\r\n  percentile <- round(prob * 100)\r\n  \r\n  # Sicherstellen dass Werte im sinnvollen Bereich sind\r\n  return(pmax(1, pmin(99, percentile)))\r\n}\r\n\r\n# UI - Nur mit Shiny, kein bslib\r\nui <- fluidPage(\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8f9fa; }\r\n      .container-fluid { max-width: 1000px; margin: 0 auto; padding: 20px; }\r\n      .panel { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }\r\n      .question-item { background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin: 15px 0; transition: all 0.3s ease; }\r\n      .question-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }\r\n      .self-section { border-left: 4px solid #007bff; }\r\n      .interpersonal-section { border-left: 4px solid #28a745; }\r\n      .results-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; }\r\n      .score-card { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 20px; margin: 10px; text-align: center; backdrop-filter: blur(10px); }\r\n      .score-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }\r\n      .score-label { font-size: 1.1em; opacity: 0.9; }\r\n      .btn-primary { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }\r\n      .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,123,255,0.3); }\r\n      .btn-secondary { background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }\r\n      .interpretation-panel { background: white; color: #333; border-radius: 12px; padding: 25px; margin: 20px 0; }\r\n      .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }\r\n      .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }\r\n      .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }\r\n      .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }\r\n      .alert-danger { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }\r\n      .norm-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\r\n      .norm-item { padding: 20px; border-radius: 10px; text-align: center; color: white; font-weight: bold; position: relative; }\r\n      .norm-good { background: linear-gradient(135deg, #28a745, #20c997); }\r\n      .norm-average { background: linear-gradient(135deg, #17a2b8, #20c997); }\r\n      .norm-elevated { background: linear-gradient(135deg, #ffc107, #fd7e14); color: #333; }\r\n      .norm-high { background: linear-gradient(135deg, #dc3545, #e83e8c); }\r\n      .your-score { background: #007bff; color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; font-size: 1.2em; font-weight: bold; }\r\n      h1, h2, h3, h4 { color: #2c3e50; margin-bottom: 15px; }\r\n      .section-title { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 8px; margin-bottom: 20px; }\r\n      .radio-option { margin: 8px 0; }\r\n      @media (max-width: 768px) {\r\n        .container-fluid { padding: 10px; }\r\n        .panel { padding: 15px; margin: 10px 0; }\r\n        .score-number { font-size: 2em; }\r\n        .norm-comparison { grid-template-columns: 1fr 1fr; }\r\n      }\r\n    \"))\r\n  ),\r\n  \r\n  title = \"LPFS-BF 2.0\",\r\n  \r\n  # Header\r\n  div(class = \"panel\",\r\n      h1(\"ðŸ‘¥ LPFS-BF 2.0\", style = \"text-align: center; color: #007bff; margin-bottom: 10px;\"),\r\n      h3(\"Level of Personality Functioning Scale\", style = \"text-align: center; color: #6c757d; font-weight: 300;\"),\r\n      hr(),\r\n      p(\"Diese validierte Skala erfasst das Funktionsniveau der PersÃ¶nlichkeit in zwei Hauptbereichen:\", \r\n        style = \"text-align: center; font-size: 1.1em; color: #666;\"),\r\n      div(style = \"text-align: center; margin: 20px 0;\",\r\n          span(\"ðŸ§â€â™‚ï¸ Selbst-Funktionen (Items 1-6)\", style = \"margin: 0 20px; color: #007bff; font-weight: 500;\"),\r\n          span(\"ðŸ‘¥ Interpersonale Funktionen (Items 7-12)\", style = \"margin: 0 20px; color: #28a745; font-weight: 500;\")\r\n      )\r\n  ),\r\n  \r\n  # Fragebogen\r\n  conditionalPanel(\r\n    condition = \"!output.show_results\",\r\n    div(class = \"panel\",\r\n        h3(\"Fragebogen\", class = \"section-title\"),\r\n        p(\"Bitte geben Sie fÃ¼r jede der folgenden Aussagen an, inwieweit diese zurzeit auf Sie zutrifft:\", \r\n          style = \"font-size: 1.1em; margin-bottom: 30px;\"),\r\n        \r\n        h4(\"ðŸ§â€â™‚ï¸ Selbst-Bereich\", style = \"color: #007bff; margin-top: 30px;\"),\r\n        lapply(1:6, function(i) {\r\n          div(class = \"question-item self-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        h4(\"ðŸ‘¥ Interpersonaler Bereich\", style = \"color: #28a745; margin-top: 40px;\"),\r\n        lapply(7:12, function(i) {\r\n          div(class = \"question-item interpersonal-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        div(style = \"text-align: center; margin: 40px 0;\",\r\n            actionButton(\"calculate\", \"ðŸŽ¯ Ergebnisse berechnen\", class = \"btn-primary\", style = \"width: 300px; height: 55px; font-size: 18px;\")\r\n        )\r\n    )\r\n  ),\r\n  \r\n  # Ergebnisse\r\n  conditionalPanel(\r\n    condition = \"output.show_results\",\r\n    \r\n    # Score Cards\r\n    div(class = \"results-container\",\r\n        h2(\"ðŸ§â€â™‚ï¸ Ihre Ergebnisse\", style = \"text-align: center; margin-bottom: 30px;\"),\r\n        fluidRow(\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"total_score\")),\r\n                        div(class = \"score-label\", \"Gesamtwert (12-48)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"self_score\")),\r\n                        div(class = \"score-label\", \"Selbst-Bereich (6-24)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"interpersonal_score\")),\r\n                        div(class = \"score-label\", \"Interpersonal (6-24)\")\r\n          ))\r\n        ),\r\n        \r\n        # Perzentil\r\n        div(class = \"score-card\", style = \"margin-top: 20px;\",\r\n            div(style = \"font-size: 3em; font-weight: bold;\", \r\n                textOutput(\"percentile\", inline = TRUE), \r\n                span(\"%\", style = \"color: #ffd700;\")\r\n            ),\r\n            div(class = \"score-label\", \"Perzentil in der deutschen BevÃ¶lkerung\"),\r\n            div(style = \"margin-top: 10px; font-size: 1.1em;\",\r\n                \"T-Wert: \", textOutput(\"t_value\", inline = TRUE)\r\n            )\r\n        )\r\n    ),\r\n    \r\n    # Interpretation\r\n    div(class = \"interpretation-panel\",\r\n        h3(\"ðŸ§â€â™€ï¸ Interpretation\", class = \"section-title\"),\r\n        uiOutput(\"interpretation\")\r\n    ),\r\n    \r\n    # Normvergleich mit Normalverteilungs-Dichtefunktion\r\n    div(class = \"panel\",\r\n        h3(\"ðŸ“Š Normvergleich\", class = \"section-title\"),\r\n        p(\"Ihre Position in der deutschen AllgemeinbevÃ¶lkerung (realer T-Wert-Bereich: 45-82):\", \r\n          style = \"margin-bottom: 15px;\"),\r\n        p(tags$em(\"Spitzer et al., 2021, n=2.470 â€¢ Nicht-klinische Stichprobe\"), \r\n          style = \"margin-bottom: 25px; color: #666; font-size: 0.9em;\"),\r\n        \r\n        # Normalverteilungsdiagramm mit vielen schmalen Balken\r\n        div(style = \"position: relative; height: 250px; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); border-radius: 10px; margin: 30px 0; padding: 20px; overflow: hidden;\",\r\n            \r\n            # JavaScript fÃ¼r dynamische Balkenerstellung (wird im Server generiert)\r\n            uiOutput(\"normal_distribution_bars\"),\r\n            \r\n            # Ihr Wert als roter Strich (wird dynamisch positioniert)\r\n            uiOutput(\"user_position_marker\"),\r\n            \r\n            # X-Achsen-Beschriftung (angepasst fÃ¼r realen T-Wert Bereich)\r\n            div(style = \"position: absolute; bottom: 5px; left: 50px; font-size: 12px; color: #666;\", \"T=45\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 150px; font-size: 12px; color: #666;\", \"T=55\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 250px; font-size: 12px; color: #666;\", \"T=65\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 350px; font-size: 12px; color: #666;\", \"T=75\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 450px; font-size: 12px; color: #666;\", \"T=82\"),\r\n            \r\n            # Hinweis auf Minimum\r\n            div(style = \"position: absolute; top: 10px; left: 50px; font-size: 11px; color: #28a745; font-weight: bold;\", \"MINIMUM\"),\r\n        ),\r\n        \r\n        # Legende (aktualisiert fÃ¼r realen T-Wert Bereich)\r\n        div(style = \"margin-top: 20px; text-align: center;\",\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #28a745; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"BestmÃ¶glich (T=45)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #17a2b8; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Durchschnitt (T46-55)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #ffc107; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"ErhÃ¶ht (T56-69)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #dc3545; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Hoch (Tâ‰¥70)\", style = \"font-size: 14px;\")\r\n            )\r\n        ),\r\n        \r\n        div(class = \"your-score\",\r\n            \"ðŸŽ¯ Ihr Wert: \", textOutput(\"your_position\", inline = TRUE)\r\n        )\r\n    ),\r\n    \r\n    div(style = \"text-align: center; margin: 30px 0;\",\r\n        actionButton(\"reset\", \"ðŸ”„ Neue Umfrage starten\", class = \"btn-secondary\")\r\n    )\r\n  )\r\n)\r\n\r\n# Server\r\nserver <- function(input, output, session) {\r\n  values <- reactiveValues(calculated = FALSE)\r\n  \r\n  observeEvent(input$calculate, {\r\n    # Sammle alle Antworten\r\n    all_items <- sapply(1:12, function(i) input[[paste0(\"item_\", i)]])\r\n    \r\n    # PrÃ¼fe ob alle beantwortet\r\n    if (any(sapply(all_items, is.null))) {\r\n      showNotification(\"ðŸ§â€â™‚ï¸ Bitte beantworten Sie alle 12 Fragen!\", type = \"warning\")\r\n      return()\r\n    }\r\n    \r\n    # Berechne Scores\r\n    scores <- as.numeric(all_items)\r\n    values$self_score <- sum(scores[1:6])\r\n    values$interpersonal_score <- sum(scores[7:12])\r\n    values$total_score <- values$self_score + values$interpersonal_score\r\n    values$percentile <- calculate_percentile(values$total_score)\r\n    \r\n    # T-Wert aus Tabelle\r\n    t_vals <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n    names(t_vals) <- 12:48\r\n    values$t_value <- t_vals[as.character(values$total_score)]\r\n    if (is.na(values$t_value)) values$t_value <- 50\r\n    \r\n    values$calculated <- TRUE\r\n    showNotification(\"ðŸŽ¯ Ergebnisse erfolgreich berechnet!\", type = \"message\")\r\n  })\r\n  \r\n  observeEvent(input$reset, {\r\n    # Alle Inputs zurÃ¼cksetzen\r\n    lapply(1:12, function(i) {\r\n      updateRadioButtons(session, paste0(\"item_\", i), selected = character(0))\r\n    })\r\n    values$calculated <- FALSE\r\n    showNotification(\"ðŸ‘¥ Fragebogen wurde zurÃ¼ckgesetzt\", type = \"message\")\r\n  })\r\n  \r\n  # Outputs\r\n  output$show_results <- reactive({ values$calculated })\r\n  outputOptions(output, \"show_results\", suspendWhenHidden = FALSE)\r\n  \r\n  output$total_score <- renderText({\r\n    if (values$calculated) as.character(values$total_score) else \"\"\r\n  })\r\n  \r\n  output$self_score <- renderText({\r\n    if (values$calculated) as.character(values$self_score) else \"\"\r\n  })\r\n  \r\n  output$interpersonal_score <- renderText({\r\n    if (values$calculated) as.character(values$interpersonal_score) else \"\"\r\n  })\r\n  \r\n  output$percentile <- renderText({\r\n    if (values$calculated) as.character(values$percentile) else \"\"\r\n  })\r\n  \r\n  output$t_value <- renderText({\r\n    if (values$calculated) as.character(values$t_value) else \"\"\r\n  })\r\n  \r\n  output$interpretation <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    percentile <- values$percentile\r\n    t_val <- values$t_value\r\n    \r\n    # Interpretation basierend auf Perzentilen - MIT METHODISCHEN HINWEISEN\r\n    if (percentile <= 31) {\r\n      alert_class <- \"alert-success\"\r\n      level <- \"ðŸ§â€â™‚ï¸ Gutes Funktionsniveau\"\r\n      if (score == 12) {\r\n        desc <- paste0(\"Sie haben das bestmÃ¶gliche Ergebnis erreicht (\", score, \" Punkte, T-Wert: \", t_val, \"). Dies ist der niedrigstmÃ¶gliche Wert und deutet auf ein ausgezeichnetes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      } else {\r\n        desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf ein gutes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      }\r\n    } else if (percentile <= 69) {\r\n      alert_class <- \"alert-info\"\r\n      level <- \"ðŸ‘¤ Durchschnittliches Funktionsniveau\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und entspricht dem durchschnittlichen Bereich der AllgemeinbevÃ¶lkerung.\")\r\n    } else if (percentile <= 93) {\r\n      alert_class <- \"alert-warning\"\r\n      level <- \"ðŸš¶â€â™‚ï¸ Leicht erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und kÃ¶nnte auf leichte Schwierigkeiten im Funktionsniveau hinweisen.\")\r\n    } else {\r\n      alert_class <- \"alert-danger\"\r\n      level <- \"ðŸ§â€â™€ï¸ Deutlich erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf bedeutsame Schwierigkeiten im Funktionsniveau hin.\")\r\n    }\r\n    \r\n    tagList(\r\n      div(class = paste(\"alert\", alert_class),\r\n          h4(level, style = \"margin-bottom: 15px;\"),\r\n          p(desc, style = \"margin-bottom: 0; font-size: 1.05em;\")\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      fluidRow(\r\n        column(6,\r\n               h5(\"ðŸ“‹ Referenzwerte:\"),\r\n               tags$ul(\r\n                 tags$li(\"Tâ‚…â‚€ = 15 Punkte (Durchschnitt)\"),\r\n                 tags$li(\"Tâ‚‡â‚€ = 33 Punkte (klinisch auffÃ¤llig)\")\r\n               )\r\n        ),\r\n        column(6,\r\n               h5(\"ðŸ§â€â™‚ï¸ Ihre Werte:\"),\r\n               tags$ul(\r\n                 tags$li(paste0(\"Selbst-Bereich: \", values$self_score, \"/24\")),\r\n                 tags$li(paste0(\"Interpersonal: \", values$interpersonal_score, \"/24\")),\r\n                 tags$li(paste0(\"Gesamt: \", score, \"/48\"))\r\n               )\r\n        )\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ“Š Methodischer Hinweis: \"), \r\n            \"Die LPFS-BF hat einen Mindestwert von 12 Punkten (bestmÃ¶gliches Ergebnis). Niemand kann niedrigere Werte erreichen. Das bedeutet, dass bei niedrigen Perzentilen nicht alle Prozentangaben unterhalb Ihres Werts liegen, sondern das die Normierung auf der gesamten theoretischen Verteilung basiert. Diese Studie wurde an einer nicht-klinischen Stichprobe durchgefÃ¼hrt.\",\r\n            style = \"margin: 0; color: #6c757d; font-size: 0.9em;\")\r\n      ),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ§â€â™€ï¸ Wichtiger Hinweis: \"), \r\n            \"Diese Auswertung dient ausschlieÃŸlich zu Informations- und Bildungszwecken. Sie ersetzt keine professionelle psychologische Diagnostik oder Beratung. Bei anhaltenden Problemen wenden Sie sich an qualifizierte FachkrÃ¤fte.\",\r\n            style = \"margin: 0; color: #6c757d;\")\r\n      ),\r\n      \r\n      div(style = \"text-align: center; margin-top: 20px;\",\r\n          tags$em(\"Referenz: Spitzer, C. et al. (2021). Psychotherapie - Psychosomatik - Medizinische Psychologie, 71, 284-293.\",\r\n                  style = \"color: #6c757d; font-size: 0.9em;\")\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$your_position <- renderText({\r\n    if (values$calculated) {\r\n      paste0(values$total_score, \" Punkte (T-Wert: \", values$t_value, \")\")\r\n    } else \"\"\r\n  })\r\n  \r\n  # Normalverteilungsbalken generieren - KORRIGIERT fÃ¼r realen T-Wert Bereich (45-82)\r\n  output$normal_distribution_bars <- renderUI({\r\n    # T-Werte von 45 bis 80 (realer Bereich laut Tabelle), alle 2er Schritte\r\n    # T=45 ist MINIMUM (12 Punkte), T=82 ist MAXIMUM (48 Punkte)\r\n    t_values <- seq(45, 79, by = 2)\r\n    \r\n    # Vordefinierte normalisierte HÃ¶hen fÃ¼r T=45-79 (basiert auf dnorm, dann skaliert)\r\n    # Peak bei T=50, abfallend zu den Seiten\r\n    heights <- c(\r\n      69, 80, 92, 105, 117, 129, 139, 148, 150, 148, 139, 129, 117, 105, 92, 80, 69, 55\r\n    )\r\n    \r\n    # Erstelle Balken\r\n    bars <- lapply(1:length(t_values), function(i) {\r\n      t_val <- t_values[i]\r\n      height <- heights[i]\r\n      \r\n      # Bestimme Farbe basierend auf T-Wert-Bereich\r\n      if (t_val <= 45) {\r\n        color <- \"#28a745\"  # GrÃ¼n\r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 55) {\r\n        color <- \"#17a2b8\"  # Blau  \r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 69) {\r\n        color <- \"#ffc107\"  # Gelb\r\n        opacity <- \"0.8\"\r\n      } else {\r\n        color <- \"#dc3545\"  # Rot\r\n        opacity <- \"0.8\"\r\n      }\r\n      \r\n      # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n      position <- 50 + ((t_val - 45) / 34) * 400\r\n      \r\n      div(style = paste0(\r\n        \"position: absolute; \",\r\n        \"left: \", position, \"px; \",\r\n        \"bottom: 25px; \",\r\n        \"width: 15px; \",\r\n        \"height: \", height, \"px; \",\r\n        \"background: \", color, \"; \",\r\n        \"border-radius: 2px 2px 0 0; \",\r\n        \"opacity: \", opacity, \"; \",\r\n        \"transition: all 0.3s ease;\"\r\n      ))\r\n    })\r\n    \r\n    return(tagList(bars))\r\n  })\r\n  \r\n  # Dynamische Positionierung des Benutzerwerts im Verteilungsdiagramm\r\n  output$user_position_marker <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    t_val <- values$t_value\r\n    \r\n    # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n    position <- 50 + ((t_val - 45) / 34) * 400\r\n    \r\n    # Begrenze Position auf sichtbare Bereiche\r\n    position <- max(50, min(450, position))\r\n    \r\n    tagList(\r\n      # Roter Strich\r\n      div(style = paste0(\"position: absolute; left: \", position, \"px; top: 10px; width: 4px; height: 180px; background: #ff0000; border-radius: 2px; box-shadow: 0 0 10px rgba(255,0,0,0.7); z-index: 10;\")),\r\n      # Pfeil nach unten\r\n      div(style = paste0(\"position: absolute; left: \", position-5, \"px; top: 185px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid #ff0000; z-index: 10;\")),\r\n      # Label\r\n      div(style = paste0(\"position: absolute; left: \", position-25, \"px; top: 200px; background: #ff0000; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap; z-index: 10;\"),\r\n          paste0(score, \" Pkt (T\", t_val, \")\")\r\n      )\r\n    )\r\n  })\r\n}\r\n\r\n# App starten\r\nshinyApp(ui = ui, server = server)","type":"text"},{"name":"Archive/app_backup_before_test.R","content":"# LPFS-BF 2.0 - REPARIERTE MINIMALE VERSION\r\n# Funktioniert garantiert - nur shiny, keine anderen Pakete!\r\n\r\nlibrary(shiny)\r\n\r\n# LPFS-BF Items\r\nitems <- c(\r\n  \"Ich weiÃŸ oft nicht wer ich wirklich bin.\",\r\n  \"Ich denke oft sehr schlecht Ã¼ber mich selbst.\",\r\n  \"Meine GefÃ¼hle Ã¤ndern sich, ohne dass ich sie im Griff habe.\",\r\n  \"Ich habe keine Ahnung, wo ich im Leben hin will.\",\r\n  \"Ich verstehe oft meine eigenen Gedanken und GefÃ¼hle nicht.\",\r\n  \"Ich stelle oft unrealistische Anforderungen an mich selbst.\",\r\n  \"Ich habe oft Schwierigkeiten, die Gedanken und GefÃ¼hle anderer zu verstehen.\",\r\n  \"Ich kann es oft schwer aushalten, wenn andere eine andere Meinung haben.\",\r\n  \"Ich verstehe oft nicht ganz, warum mein Verhalten einen bestimmten Einfluss auf andere hat.\",\r\n  \"Meine Beziehungen und Freundschaften halten nie lange.\",\r\n  \"Ich fÃ¼hle mich oft sehr verletzlich, wenn Beziehungen persÃ¶nlicher werden.\",\r\n  \"Es gelingt mir hÃ¤ufig nicht, mit anderen auf eine Weise zusammen zu arbeiten, die fÃ¼r beide Seiten zufriedenstellend ist.\"\r\n)\r\n\r\n# T-Werte zu Perzentil Konvertierung - KONTINUIERLICH & PRÃ„ZISE\r\ncalculate_percentile <- function(score) {\r\n  t_values <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n  names(t_values) <- 12:48\r\n  \r\n  if (score < 12) return(1)\r\n  if (score > 48) return(99)\r\n  \r\n  t_val <- t_values[as.character(score)]\r\n  if (is.na(t_val)) t_val <- 50\r\n  \r\n  # Kontinuierliche Normalverteilungs-CDF Approximation\r\n  # T-Werte: T = 50 + 10*z, also z = (T-50)/10\r\n  z_score <- (t_val - 50) / 10\r\n  \r\n  # Begrenzen auf sinnvolle Werte\r\n  z_score <- pmax(-3, pmin(3, z_score))\r\n  \r\n  # PrÃ¤zise Approximation der Standard-Normalverteilung CDF\r\n  # Abramowitz & Stegun Approximation (sehr genau)\r\n  if (z_score >= 0) {\r\n    # FÃ¼r positive z-scores\r\n    t <- 1 / (1 + 0.2316419 * z_score)\r\n    d <- 0.3989423 * exp(-z_score * z_score / 2)\r\n    prob <- 1 - d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  } else {\r\n    # FÃ¼r negative z-scores: Î¦(-z) = 1 - Î¦(z)\r\n    z_pos <- -z_score\r\n    t <- 1 / (1 + 0.2316419 * z_pos)\r\n    d <- 0.3989423 * exp(-z_pos * z_pos / 2)\r\n    prob <- d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  }\r\n  \r\n  # Konvertiere zu Perzentil (0-100)\r\n  percentile <- round(prob * 100)\r\n  \r\n  # Sicherstellen dass Werte im sinnvollen Bereich sind\r\n  return(pmax(1, pmin(99, percentile)))\r\n}\r\n\r\n# UI - Nur mit Shiny, kein bslib\r\nui <- fluidPage(\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8f9fa; }\r\n      .container-fluid { max-width: 1000px; margin: 0 auto; padding: 20px; }\r\n      .panel { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }\r\n      .question-item { background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin: 15px 0; transition: all 0.3s ease; }\r\n      .question-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }\r\n      .self-section { border-left: 4px solid #007bff; }\r\n      .interpersonal-section { border-left: 4px solid #28a745; }\r\n      .results-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; }\r\n      .score-card { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 20px; margin: 10px; text-align: center; backdrop-filter: blur(10px); }\r\n      .score-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }\r\n      .score-label { font-size: 1.1em; opacity: 0.9; }\r\n      .btn-primary { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }\r\n      .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,123,255,0.3); }\r\n      .btn-secondary { background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }\r\n      .interpretation-panel { background: white; color: #333; border-radius: 12px; padding: 25px; margin: 20px 0; }\r\n      .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }\r\n      .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }\r\n      .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }\r\n      .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }\r\n      .alert-danger { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }\r\n      .norm-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\r\n      .norm-item { padding: 20px; border-radius: 10px; text-align: center; color: white; font-weight: bold; position: relative; }\r\n      .norm-good { background: linear-gradient(135deg, #28a745, #20c997); }\r\n      .norm-average { background: linear-gradient(135deg, #17a2b8, #20c997); }\r\n      .norm-elevated { background: linear-gradient(135deg, #ffc107, #fd7e14); color: #333; }\r\n      .norm-high { background: linear-gradient(135deg, #dc3545, #e83e8c); }\r\n      .your-score { background: #007bff; color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; font-size: 1.2em; font-weight: bold; }\r\n      h1, h2, h3, h4 { color: #2c3e50; margin-bottom: 15px; }\r\n      .section-title { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 8px; margin-bottom: 20px; }\r\n      .radio-option { margin: 8px 0; }\r\n      @media (max-width: 768px) {\r\n        .container-fluid { padding: 10px; }\r\n        .panel { padding: 15px; margin: 10px 0; }\r\n        .score-number { font-size: 2em; }\r\n        .norm-comparison { grid-template-columns: 1fr 1fr; }\r\n      }\r\n    \"))\r\n  ),\r\n  \r\n  title = \"LPFS-BF 2.0\",\r\n  \r\n  # Header\r\n  div(class = \"panel\",\r\n      h1(\"ðŸ‘¥ LPFS-BF 2.0\", style = \"text-align: center; color: #007bff; margin-bottom: 10px;\"),\r\n      h3(\"Level of Personality Functioning Scale\", style = \"text-align: center; color: #6c757d; font-weight: 300;\"),\r\n      hr(),\r\n      p(\"Diese validierte Skala erfasst das Funktionsniveau der PersÃ¶nlichkeit in zwei Hauptbereichen:\", \r\n        style = \"text-align: center; font-size: 1.1em; color: #666;\"),\r\n      div(style = \"text-align: center; margin: 20px 0;\",\r\n          span(\"ðŸ§â€â™‚ï¸ Selbst-Funktionen (Items 1-6)\", style = \"margin: 0 20px; color: #007bff; font-weight: 500;\"),\r\n          span(\"ðŸ‘¥ Interpersonale Funktionen (Items 7-12)\", style = \"margin: 0 20px; color: #28a745; font-weight: 500;\")\r\n      )\r\n  ),\r\n  \r\n  # Fragebogen\r\n  conditionalPanel(\r\n    condition = \"!output.show_results\",\r\n    div(class = \"panel\",\r\n        h3(\"Fragebogen\", class = \"section-title\"),\r\n        p(\"Bitte geben Sie fÃ¼r jede der folgenden Aussagen an, inwieweit diese zurzeit auf Sie zutrifft:\", \r\n          style = \"font-size: 1.1em; margin-bottom: 30px;\"),\r\n        \r\n        h4(\"ðŸ§â€â™‚ï¸ Selbst-Bereich\", style = \"color: #007bff; margin-top: 30px;\"),\r\n        lapply(1:6, function(i) {\r\n          div(class = \"question-item self-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        h4(\"ðŸ‘¥ Interpersonaler Bereich\", style = \"color: #28a745; margin-top: 40px;\"),\r\n        lapply(7:12, function(i) {\r\n          div(class = \"question-item interpersonal-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        div(style = \"text-align: center; margin: 40px 0;\",\r\n            actionButton(\"calculate\", \"ðŸŽ¯ Ergebnisse berechnen\", class = \"btn-primary\", style = \"width: 300px; height: 55px; font-size: 18px;\")\r\n        )\r\n    )\r\n  ),\r\n  \r\n  # Ergebnisse\r\n  conditionalPanel(\r\n    condition = \"output.show_results\",\r\n    \r\n    # Score Cards\r\n    div(class = \"results-container\",\r\n        h2(\"ðŸ§â€â™‚ï¸ Ihre Ergebnisse\", style = \"text-align: center; margin-bottom: 30px;\"),\r\n        fluidRow(\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"total_score\")),\r\n                        div(class = \"score-label\", \"Gesamtwert (12-48)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"self_score\")),\r\n                        div(class = \"score-label\", \"Selbst-Bereich (6-24)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"interpersonal_score\")),\r\n                        div(class = \"score-label\", \"Interpersonal (6-24)\")\r\n          ))\r\n        ),\r\n        \r\n        # Perzentil\r\n        div(class = \"score-card\", style = \"margin-top: 20px;\",\r\n            div(style = \"font-size: 3em; font-weight: bold;\", \r\n                textOutput(\"percentile\", inline = TRUE), \r\n                span(\"%\", style = \"color: #ffd700;\")\r\n            ),\r\n            div(class = \"score-label\", \"Perzentil in der deutschen BevÃ¶lkerung\"),\r\n            div(style = \"margin-top: 10px; font-size: 1.1em;\",\r\n                \"T-Wert: \", textOutput(\"t_value\", inline = TRUE)\r\n            )\r\n        )\r\n    ),\r\n    \r\n    # Interpretation\r\n    div(class = \"interpretation-panel\",\r\n        h3(\"ðŸ§â€â™€ï¸ Interpretation\", class = \"section-title\"),\r\n        uiOutput(\"interpretation\")\r\n    ),\r\n    \r\n    # Normvergleich mit Normalverteilungs-Dichtefunktion\r\n    div(class = \"panel\",\r\n        h3(\"ðŸ“Š Normvergleich\", class = \"section-title\"),\r\n        p(\"Ihre Position in der deutschen AllgemeinbevÃ¶lkerung (realer T-Wert-Bereich: 45-82):\", \r\n          style = \"margin-bottom: 15px;\"),\r\n        p(tags$em(\"Spitzer et al., 2021, n=2.470 â€¢ Nicht-klinische Stichprobe\"), \r\n          style = \"margin-bottom: 25px; color: #666; font-size: 0.9em;\"),\r\n        \r\n        # Normalverteilungsdiagramm mit vielen schmalen Balken\r\n        div(style = \"position: relative; height: 250px; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); border-radius: 10px; margin: 30px 0; padding: 20px; overflow: hidden;\",\r\n            \r\n            # JavaScript fÃ¼r dynamische Balkenerstellung (wird im Server generiert)\r\n            uiOutput(\"normal_distribution_bars\"),\r\n            \r\n            # Ihr Wert als roter Strich (wird dynamisch positioniert)\r\n            uiOutput(\"user_position_marker\"),\r\n            \r\n            # X-Achsen-Beschriftung (angepasst fÃ¼r realen T-Wert Bereich)\r\n            div(style = \"position: absolute; bottom: 5px; left: 50px; font-size: 12px; color: #666;\", \"T=45\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 150px; font-size: 12px; color: #666;\", \"T=55\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 250px; font-size: 12px; color: #666;\", \"T=65\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 350px; font-size: 12px; color: #666;\", \"T=75\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 450px; font-size: 12px; color: #666;\", \"T=82\"),\r\n            \r\n            # Hinweis auf Minimum\r\n            div(style = \"position: absolute; top: 10px; left: 50px; font-size: 11px; color: #28a745; font-weight: bold;\", \"MINIMUM\"),\r\n        ),\r\n        \r\n        # Legende (aktualisiert fÃ¼r realen T-Wert Bereich)\r\n        div(style = \"margin-top: 20px; text-align: center;\",\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #28a745; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"BestmÃ¶glich (T=45)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #17a2b8; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Durchschnitt (T46-55)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #ffc107; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"ErhÃ¶ht (T56-69)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #dc3545; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Hoch (Tâ‰¥70)\", style = \"font-size: 14px;\")\r\n            )\r\n        ),\r\n        \r\n        div(class = \"your-score\",\r\n            \"ðŸŽ¯ Ihr Wert: \", textOutput(\"your_position\", inline = TRUE)\r\n        )\r\n    ),\r\n    \r\n    div(style = \"text-align: center; margin: 30px 0;\",\r\n        actionButton(\"reset\", \"ðŸ”„ Neue Umfrage starten\", class = \"btn-secondary\")\r\n    )\r\n  )\r\n)\r\n\r\n# Server\r\nserver <- function(input, output, session) {\r\n  values <- reactiveValues(calculated = FALSE)\r\n  \r\n  observeEvent(input$calculate, {\r\n    # Sammle alle Antworten\r\n    all_items <- sapply(1:12, function(i) input[[paste0(\"item_\", i)]])\r\n    \r\n    # PrÃ¼fe ob alle beantwortet\r\n    if (any(sapply(all_items, is.null))) {\r\n      # Validation message will be shown in UI instead of notification\r\n      return()\r\n    }\r\n    \r\n    # Berechne Scores\r\n    scores <- as.numeric(all_items)\r\n    values$self_score <- sum(scores[1:6])\r\n    values$interpersonal_score <- sum(scores[7:12])\r\n    values$total_score <- values$self_score + values$interpersonal_score\r\n    values$percentile <- calculate_percentile(values$total_score)\r\n    \r\n    # T-Wert aus Tabelle\r\n    t_vals <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n    names(t_vals) <- 12:48\r\n    values$t_value <- t_vals[as.character(values$total_score)]\r\n    if (is.na(values$t_value)) values$t_value <- 50\r\n    \r\n    values$calculated <- TRUE\r\n    # Success message will be shown in UI instead of notification\r\n  })\r\n  \r\n  observeEvent(input$reset, {\r\n    # Alle Inputs zurÃ¼cksetzen\r\n    lapply(1:12, function(i) {\r\n      updateRadioButtons(session, paste0(\"item_\", i), selected = character(0))\r\n    })\r\n    values$calculated <- FALSE\r\n    # Reset message will be shown in UI instead of notification\r\n  })\r\n  \r\n  # Outputs\r\n  output$show_results <- reactive({ values$calculated })\r\n  outputOptions(output, \"show_results\", suspendWhenHidden = FALSE)\r\n  \r\n  output$total_score <- renderText({\r\n    if (values$calculated) as.character(values$total_score) else \"\"\r\n  })\r\n  \r\n  output$self_score <- renderText({\r\n    if (values$calculated) as.character(values$self_score) else \"\"\r\n  })\r\n  \r\n  output$interpersonal_score <- renderText({\r\n    if (values$calculated) as.character(values$interpersonal_score) else \"\"\r\n  })\r\n  \r\n  output$percentile <- renderText({\r\n    if (values$calculated) as.character(values$percentile) else \"\"\r\n  })\r\n  \r\n  output$t_value <- renderText({\r\n    if (values$calculated) as.character(values$t_value) else \"\"\r\n  })\r\n  \r\n  output$interpretation <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    percentile <- values$percentile\r\n    t_val <- values$t_value\r\n    \r\n    # Interpretation basierend auf Perzentilen - MIT METHODISCHEN HINWEISEN\r\n    if (percentile <= 31) {\r\n      alert_class <- \"alert-success\"\r\n      level <- \"ðŸ§â€â™‚ï¸ Gutes Funktionsniveau\"\r\n      if (score == 12) {\r\n        desc <- paste0(\"Sie haben das bestmÃ¶gliche Ergebnis erreicht (\", score, \" Punkte, T-Wert: \", t_val, \"). Dies ist der niedrigstmÃ¶gliche Wert und deutet auf ein ausgezeichnetes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      } else {\r\n        desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf ein gutes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      }\r\n    } else if (percentile <= 69) {\r\n      alert_class <- \"alert-info\"\r\n      level <- \"ðŸ‘¤ Durchschnittliches Funktionsniveau\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und entspricht dem durchschnittlichen Bereich der AllgemeinbevÃ¶lkerung.\")\r\n    } else if (percentile <= 93) {\r\n      alert_class <- \"alert-warning\"\r\n      level <- \"ðŸš¶â€â™‚ï¸ Leicht erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und kÃ¶nnte auf leichte Schwierigkeiten im Funktionsniveau hinweisen.\")\r\n    } else {\r\n      alert_class <- \"alert-danger\"\r\n      level <- \"ðŸ§â€â™€ï¸ Deutlich erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf bedeutsame Schwierigkeiten im Funktionsniveau hin.\")\r\n    }\r\n    \r\n    tagList(\r\n      div(class = paste(\"alert\", alert_class),\r\n          h4(level, style = \"margin-bottom: 15px;\"),\r\n          p(desc, style = \"margin-bottom: 0; font-size: 1.05em;\")\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      fluidRow(\r\n        column(6,\r\n               h5(\"ðŸ“‹ Referenzwerte:\"),\r\n               tags$ul(\r\n                 tags$li(\"Tâ‚…â‚€ = 15 Punkte (Durchschnitt)\"),\r\n                 tags$li(\"Tâ‚‡â‚€ = 33 Punkte (klinisch auffÃ¤llig)\")\r\n               )\r\n        ),\r\n        column(6,\r\n               h5(\"ðŸ§â€â™‚ï¸ Ihre Werte:\"),\r\n               tags$ul(\r\n                 tags$li(paste0(\"Selbst-Bereich: \", values$self_score, \"/24\")),\r\n                 tags$li(paste0(\"Interpersonal: \", values$interpersonal_score, \"/24\")),\r\n                 tags$li(paste0(\"Gesamt: \", score, \"/48\"))\r\n               )\r\n        )\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ“Š Methodischer Hinweis: \"), \r\n            \"Die LPFS-BF hat einen Mindestwert von 12 Punkten (bestmÃ¶gliches Ergebnis). Niemand kann niedrigere Werte erreichen. Das bedeutet, dass bei niedrigen Perzentilen nicht alle Prozentangaben unterhalb Ihres Werts liegen, sondern das die Normierung auf der gesamten theoretischen Verteilung basiert. Diese Studie wurde an einer nicht-klinischen Stichprobe durchgefÃ¼hrt.\",\r\n            style = \"margin: 0; color: #6c757d; font-size: 0.9em;\")\r\n      ),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ§â€â™€ï¸ Wichtiger Hinweis: \"), \r\n            \"Diese Auswertung dient ausschlieÃŸlich zu Informations- und Bildungszwecken. Sie ersetzt keine professionelle psychologische Diagnostik oder Beratung. Bei anhaltenden Problemen wenden Sie sich an qualifizierte FachkrÃ¤fte.\",\r\n            style = \"margin: 0; color: #6c757d;\")\r\n      ),\r\n      \r\n      div(style = \"text-align: center; margin-top: 20px;\",\r\n          tags$em(\"Referenz: Spitzer, C. et al. (2021). Psychotherapie - Psychosomatik - Medizinische Psychologie, 71, 284-293.\",\r\n                  style = \"color: #6c757d; font-size: 0.9em;\")\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$your_position <- renderText({\r\n    if (values$calculated) {\r\n      paste0(values$total_score, \" Punkte (T-Wert: \", values$t_value, \")\")\r\n    } else \"\"\r\n  })\r\n  \r\n  # Normalverteilungsbalken generieren - KORRIGIERT fÃ¼r realen T-Wert Bereich (45-82)\r\n  output$normal_distribution_bars <- renderUI({\r\n    # T-Werte von 45 bis 80 (realer Bereich laut Tabelle), alle 2er Schritte\r\n    # T=45 ist MINIMUM (12 Punkte), T=82 ist MAXIMUM (48 Punkte)\r\n    t_values <- seq(45, 79, by = 2)\r\n    \r\n    # Vordefinierte normalisierte HÃ¶hen fÃ¼r T=45-79 (basiert auf dnorm, dann skaliert)\r\n    # Peak bei T=50, abfallend zu den Seiten\r\n    heights <- c(\r\n      69, 80, 92, 105, 117, 129, 139, 148, 150, 148, 139, 129, 117, 105, 92, 80, 69, 55\r\n    )\r\n    \r\n    # Erstelle Balken\r\n    bars <- lapply(1:length(t_values), function(i) {\r\n      t_val <- t_values[i]\r\n      height <- heights[i]\r\n      \r\n      # Bestimme Farbe basierend auf T-Wert-Bereich\r\n      if (t_val <= 45) {\r\n        color <- \"#28a745\"  # GrÃ¼n\r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 55) {\r\n        color <- \"#17a2b8\"  # Blau  \r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 69) {\r\n        color <- \"#ffc107\"  # Gelb\r\n        opacity <- \"0.8\"\r\n      } else {\r\n        color <- \"#dc3545\"  # Rot\r\n        opacity <- \"0.8\"\r\n      }\r\n      \r\n      # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n      position <- 50 + ((t_val - 45) / 34) * 400\r\n      \r\n      div(style = paste0(\r\n        \"position: absolute; \",\r\n        \"left: \", position, \"px; \",\r\n        \"bottom: 25px; \",\r\n        \"width: 15px; \",\r\n        \"height: \", height, \"px; \",\r\n        \"background: \", color, \"; \",\r\n        \"border-radius: 2px 2px 0 0; \",\r\n        \"opacity: \", opacity, \"; \",\r\n        \"transition: all 0.3s ease;\"\r\n      ))\r\n    })\r\n    \r\n    return(tagList(bars))\r\n  })\r\n  \r\n  # Dynamische Positionierung des Benutzerwerts im Verteilungsdiagramm\r\n  output$user_position_marker <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    t_val <- values$t_value\r\n    \r\n    # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n    position <- 50 + ((t_val - 45) / 34) * 400\r\n    \r\n    # Begrenze Position auf sichtbare Bereiche\r\n    position <- max(50, min(450, position))\r\n    \r\n    tagList(\r\n      # Roter Strich\r\n      div(style = paste0(\"position: absolute; left: \", position, \"px; top: 10px; width: 4px; height: 180px; background: #ff0000; border-radius: 2px; box-shadow: 0 0 10px rgba(255,0,0,0.7); z-index: 10;\")),\r\n      # Pfeil nach unten\r\n      div(style = paste0(\"position: absolute; left: \", position-5, \"px; top: 185px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid #ff0000; z-index: 10;\")),\r\n      # Label\r\n      div(style = paste0(\"position: absolute; left: \", position-25, \"px; top: 200px; background: #ff0000; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap; z-index: 10;\"),\r\n          paste0(score, \" Pkt (T\", t_val, \")\")\r\n      )\r\n    )\r\n  })\r\n}\r\n\r\n# App starten\r\nshinyApp(ui = ui, server = server)\r\n","type":"text"},{"name":"Archive/app_original_backup.R","content":"# LPFS-BF 2.0 - REPARIERTE MINIMALE VERSION\r\n# Funktioniert garantiert - nur shiny, keine anderen Pakete!\r\n\r\nlibrary(shiny)\r\n\r\n# LPFS-BF Items\r\nitems <- c(\r\n  \"Ich weiÃŸ oft nicht wer ich wirklich bin.\",\r\n  \"Ich denke oft sehr schlecht Ã¼ber mich selbst.\",\r\n  \"Meine GefÃ¼hle Ã¤ndern sich, ohne dass ich sie im Griff habe.\",\r\n  \"Ich habe keine Ahnung, wo ich im Leben hin will.\",\r\n  \"Ich verstehe oft meine eigenen Gedanken und GefÃ¼hle nicht.\",\r\n  \"Ich stelle oft unrealistische Anforderungen an mich selbst.\",\r\n  \"Ich habe oft Schwierigkeiten, die Gedanken und GefÃ¼hle anderer zu verstehen.\",\r\n  \"Ich kann es oft schwer aushalten, wenn andere eine andere Meinung haben.\",\r\n  \"Ich verstehe oft nicht ganz, warum mein Verhalten einen bestimmten Einfluss auf andere hat.\",\r\n  \"Meine Beziehungen und Freundschaften halten nie lange.\",\r\n  \"Ich fÃ¼hle mich oft sehr verletzlich, wenn Beziehungen persÃ¶nlicher werden.\",\r\n  \"Es gelingt mir hÃ¤ufig nicht, mit anderen auf eine Weise zusammen zu arbeiten, die fÃ¼r beide Seiten zufriedenstellend ist.\"\r\n)\r\n\r\n# T-Werte zu Perzentil Konvertierung - KONTINUIERLICH & PRÃ„ZISE\r\ncalculate_percentile <- function(score) {\r\n  t_values <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n  names(t_values) <- 12:48\r\n  \r\n  if (score < 12) return(1)\r\n  if (score > 48) return(99)\r\n  \r\n  t_val <- t_values[as.character(score)]\r\n  if (is.na(t_val)) t_val <- 50\r\n  \r\n  # Kontinuierliche Normalverteilungs-CDF Approximation\r\n  # T-Werte: T = 50 + 10*z, also z = (T-50)/10\r\n  z_score <- (t_val - 50) / 10\r\n  \r\n  # Begrenzen auf sinnvolle Werte\r\n  z_score <- pmax(-3, pmin(3, z_score))\r\n  \r\n  # PrÃ¤zise Approximation der Standard-Normalverteilung CDF\r\n  # Abramowitz & Stegun Approximation (sehr genau)\r\n  if (z_score >= 0) {\r\n    # FÃ¼r positive z-scores\r\n    t <- 1 / (1 + 0.2316419 * z_score)\r\n    d <- 0.3989423 * exp(-z_score * z_score / 2)\r\n    prob <- 1 - d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  } else {\r\n    # FÃ¼r negative z-scores: Î¦(-z) = 1 - Î¦(z)\r\n    z_pos <- -z_score\r\n    t <- 1 / (1 + 0.2316419 * z_pos)\r\n    d <- 0.3989423 * exp(-z_pos * z_pos / 2)\r\n    prob <- d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  }\r\n  \r\n  # Konvertiere zu Perzentil (0-100)\r\n  percentile <- round(prob * 100)\r\n  \r\n  # Sicherstellen dass Werte im sinnvollen Bereich sind\r\n  return(pmax(1, pmin(99, percentile)))\r\n}\r\n\r\n# UI - Nur mit Shiny, kein bslib\r\nui <- fluidPage(\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8f9fa; }\r\n      .container-fluid { max-width: 1000px; margin: 0 auto; padding: 20px; }\r\n      .panel { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }\r\n      .question-item { background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin: 15px 0; transition: all 0.3s ease; }\r\n      .question-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }\r\n      .self-section { border-left: 4px solid #007bff; }\r\n      .interpersonal-section { border-left: 4px solid #28a745; }\r\n      .results-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; }\r\n      .score-card { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 20px; margin: 10px; text-align: center; backdrop-filter: blur(10px); }\r\n      .score-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }\r\n      .score-label { font-size: 1.1em; opacity: 0.9; }\r\n      .btn-primary { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }\r\n      .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,123,255,0.3); }\r\n      .btn-secondary { background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }\r\n      .interpretation-panel { background: white; color: #333; border-radius: 12px; padding: 25px; margin: 20px 0; }\r\n      .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }\r\n      .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }\r\n      .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }\r\n      .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }\r\n      .alert-danger { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }\r\n      .norm-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\r\n      .norm-item { padding: 20px; border-radius: 10px; text-align: center; color: white; font-weight: bold; position: relative; }\r\n      .norm-good { background: linear-gradient(135deg, #28a745, #20c997); }\r\n      .norm-average { background: linear-gradient(135deg, #17a2b8, #20c997); }\r\n      .norm-elevated { background: linear-gradient(135deg, #ffc107, #fd7e14); color: #333; }\r\n      .norm-high { background: linear-gradient(135deg, #dc3545, #e83e8c); }\r\n      .your-score { background: #007bff; color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; font-size: 1.2em; font-weight: bold; }\r\n      h1, h2, h3, h4 { color: #2c3e50; margin-bottom: 15px; }\r\n      .section-title { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 8px; margin-bottom: 20px; }\r\n      .radio-option { margin: 8px 0; }\r\n      @media (max-width: 768px) {\r\n        .container-fluid { padding: 10px; }\r\n        .panel { padding: 15px; margin: 10px 0; }\r\n        .score-number { font-size: 2em; }\r\n        .norm-comparison { grid-template-columns: 1fr 1fr; }\r\n      }\r\n    \"))\r\n  ),\r\n  \r\n  title = \"LPFS-BF 2.0\",\r\n  \r\n  # Header\r\n  div(class = \"panel\",\r\n      h1(\"ðŸ‘¥ LPFS-BF 2.0\", style = \"text-align: center; color: #007bff; margin-bottom: 10px;\"),\r\n      h3(\"Level of Personality Functioning Scale\", style = \"text-align: center; color: #6c757d; font-weight: 300;\"),\r\n      hr(),\r\n      p(\"Diese validierte Skala erfasst das Funktionsniveau der PersÃ¶nlichkeit in zwei Hauptbereichen:\", \r\n        style = \"text-align: center; font-size: 1.1em; color: #666;\"),\r\n      div(style = \"text-align: center; margin: 20px 0;\",\r\n          span(\"ðŸ§â€â™‚ï¸ Selbst-Funktionen (Items 1-6)\", style = \"margin: 0 20px; color: #007bff; font-weight: 500;\"),\r\n          span(\"ðŸ‘¥ Interpersonale Funktionen (Items 7-12)\", style = \"margin: 0 20px; color: #28a745; font-weight: 500;\")\r\n      )\r\n  ),\r\n  \r\n  # Fragebogen\r\n  conditionalPanel(\r\n    condition = \"!output.show_results\",\r\n    div(class = \"panel\",\r\n        h3(\"Fragebogen\", class = \"section-title\"),\r\n        p(\"Bitte geben Sie fÃ¼r jede der folgenden Aussagen an, inwieweit diese zurzeit auf Sie zutrifft:\", \r\n          style = \"font-size: 1.1em; margin-bottom: 30px;\"),\r\n        \r\n        h4(\"ðŸ§â€â™‚ï¸ Selbst-Bereich\", style = \"color: #007bff; margin-top: 30px;\"),\r\n        lapply(1:6, function(i) {\r\n          div(class = \"question-item self-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        h4(\"ðŸ‘¥ Interpersonaler Bereich\", style = \"color: #28a745; margin-top: 40px;\"),\r\n        lapply(7:12, function(i) {\r\n          div(class = \"question-item interpersonal-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        div(style = \"text-align: center; margin: 40px 0;\",\r\n            actionButton(\"calculate\", \"ðŸŽ¯ Ergebnisse berechnen\", class = \"btn-primary\", style = \"width: 300px; height: 55px; font-size: 18px;\")\r\n        )\r\n    )\r\n  ),\r\n  \r\n  # Ergebnisse\r\n  conditionalPanel(\r\n    condition = \"output.show_results\",\r\n    \r\n    # Score Cards\r\n    div(class = \"results-container\",\r\n        h2(\"ðŸ§â€â™‚ï¸ Ihre Ergebnisse\", style = \"text-align: center; margin-bottom: 30px;\"),\r\n        fluidRow(\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"total_score\")),\r\n                        div(class = \"score-label\", \"Gesamtwert (12-48)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"self_score\")),\r\n                        div(class = \"score-label\", \"Selbst-Bereich (6-24)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"interpersonal_score\")),\r\n                        div(class = \"score-label\", \"Interpersonal (6-24)\")\r\n          ))\r\n        ),\r\n        \r\n        # Perzentil\r\n        div(class = \"score-card\", style = \"margin-top: 20px;\",\r\n            div(style = \"font-size: 3em; font-weight: bold;\", \r\n                textOutput(\"percentile\", inline = TRUE), \r\n                span(\"%\", style = \"color: #ffd700;\")\r\n            ),\r\n            div(class = \"score-label\", \"Perzentil in der deutschen BevÃ¶lkerung\"),\r\n            div(style = \"margin-top: 10px; font-size: 1.1em;\",\r\n                \"T-Wert: \", textOutput(\"t_value\", inline = TRUE)\r\n            )\r\n        )\r\n    ),\r\n    \r\n    # Interpretation\r\n    div(class = \"interpretation-panel\",\r\n        h3(\"ðŸ§â€â™€ï¸ Interpretation\", class = \"section-title\"),\r\n        uiOutput(\"interpretation\")\r\n    ),\r\n    \r\n    # Normvergleich mit Normalverteilungs-Dichtefunktion\r\n    div(class = \"panel\",\r\n        h3(\"ðŸ“Š Normvergleich\", class = \"section-title\"),\r\n        p(\"Ihre Position in der deutschen AllgemeinbevÃ¶lkerung (realer T-Wert-Bereich: 45-82):\", \r\n          style = \"margin-bottom: 15px;\"),\r\n        p(tags$em(\"Spitzer et al., 2021, n=2.470 â€¢ Nicht-klinische Stichprobe\"), \r\n          style = \"margin-bottom: 25px; color: #666; font-size: 0.9em;\"),\r\n        \r\n        # Normalverteilungsdiagramm mit vielen schmalen Balken\r\n        div(style = \"position: relative; height: 250px; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); border-radius: 10px; margin: 30px 0; padding: 20px; overflow: hidden;\",\r\n            \r\n            # JavaScript fÃ¼r dynamische Balkenerstellung (wird im Server generiert)\r\n            uiOutput(\"normal_distribution_bars\"),\r\n            \r\n            # Ihr Wert als roter Strich (wird dynamisch positioniert)\r\n            uiOutput(\"user_position_marker\"),\r\n            \r\n            # X-Achsen-Beschriftung (angepasst fÃ¼r realen T-Wert Bereich)\r\n            div(style = \"position: absolute; bottom: 5px; left: 50px; font-size: 12px; color: #666;\", \"T=45\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 150px; font-size: 12px; color: #666;\", \"T=55\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 250px; font-size: 12px; color: #666;\", \"T=65\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 350px; font-size: 12px; color: #666;\", \"T=75\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 450px; font-size: 12px; color: #666;\", \"T=82\"),\r\n            \r\n            # Hinweis auf Minimum\r\n            div(style = \"position: absolute; top: 10px; left: 50px; font-size: 11px; color: #28a745; font-weight: bold;\", \"MINIMUM\"),\r\n        ),\r\n        \r\n        # Legende (aktualisiert fÃ¼r realen T-Wert Bereich)\r\n        div(style = \"margin-top: 20px; text-align: center;\",\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #28a745; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"BestmÃ¶glich (T=45)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #17a2b8; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Durchschnitt (T46-55)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #ffc107; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"ErhÃ¶ht (T56-69)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #dc3545; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Hoch (Tâ‰¥70)\", style = \"font-size: 14px;\")\r\n            )\r\n        ),\r\n        \r\n        div(class = \"your-score\",\r\n            \"ðŸŽ¯ Ihr Wert: \", textOutput(\"your_position\", inline = TRUE)\r\n        )\r\n    ),\r\n    \r\n    div(style = \"text-align: center; margin: 30px 0;\",\r\n        actionButton(\"reset\", \"ðŸ”„ Neue Umfrage starten\", class = \"btn-secondary\")\r\n    )\r\n  )\r\n)\r\n\r\n# Server\r\nserver <- function(input, output, session) {\r\n  values <- reactiveValues(calculated = FALSE)\r\n  \r\n  observeEvent(input$calculate, {\r\n    # Sammle alle Antworten\r\n    all_items <- sapply(1:12, function(i) input[[paste0(\"item_\", i)]])\r\n    \r\n    # PrÃ¼fe ob alle beantwortet\r\n    if (any(sapply(all_items, is.null))) {\r\n      showNotification(\"ðŸ§â€â™‚ï¸ Bitte beantworten Sie alle 12 Fragen!\", type = \"warning\")\r\n      return()\r\n    }\r\n    \r\n    # Berechne Scores\r\n    scores <- as.numeric(all_items)\r\n    values$self_score <- sum(scores[1:6])\r\n    values$interpersonal_score <- sum(scores[7:12])\r\n    values$total_score <- values$self_score + values$interpersonal_score\r\n    values$percentile <- calculate_percentile(values$total_score)\r\n    \r\n    # T-Wert aus Tabelle\r\n    t_vals <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n    names(t_vals) <- 12:48\r\n    values$t_value <- t_vals[as.character(values$total_score)]\r\n    if (is.na(values$t_value)) values$t_value <- 50\r\n    \r\n    values$calculated <- TRUE\r\n    showNotification(\"ðŸŽ¯ Ergebnisse erfolgreich berechnet!\", type = \"message\")\r\n  })\r\n  \r\n  observeEvent(input$reset, {\r\n    # Alle Inputs zurÃ¼cksetzen\r\n    lapply(1:12, function(i) {\r\n      updateRadioButtons(session, paste0(\"item_\", i), selected = character(0))\r\n    })\r\n    values$calculated <- FALSE\r\n    showNotification(\"ðŸ‘¥ Fragebogen wurde zurÃ¼ckgesetzt\", type = \"message\")\r\n  })\r\n  \r\n  # Outputs\r\n  output$show_results <- reactive({ values$calculated })\r\n  outputOptions(output, \"show_results\", suspendWhenHidden = FALSE)\r\n  \r\n  output$total_score <- renderText({\r\n    if (values$calculated) as.character(values$total_score) else \"\"\r\n  })\r\n  \r\n  output$self_score <- renderText({\r\n    if (values$calculated) as.character(values$self_score) else \"\"\r\n  })\r\n  \r\n  output$interpersonal_score <- renderText({\r\n    if (values$calculated) as.character(values$interpersonal_score) else \"\"\r\n  })\r\n  \r\n  output$percentile <- renderText({\r\n    if (values$calculated) as.character(values$percentile) else \"\"\r\n  })\r\n  \r\n  output$t_value <- renderText({\r\n    if (values$calculated) as.character(values$t_value) else \"\"\r\n  })\r\n  \r\n  output$interpretation <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    percentile <- values$percentile\r\n    t_val <- values$t_value\r\n    \r\n    # Interpretation basierend auf Perzentilen - MIT METHODISCHEN HINWEISEN\r\n    if (percentile <= 31) {\r\n      alert_class <- \"alert-success\"\r\n      level <- \"ðŸ§â€â™‚ï¸ Gutes Funktionsniveau\"\r\n      if (score == 12) {\r\n        desc <- paste0(\"Sie haben das bestmÃ¶gliche Ergebnis erreicht (\", score, \" Punkte, T-Wert: \", t_val, \"). Dies ist der niedrigstmÃ¶gliche Wert und deutet auf ein ausgezeichnetes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      } else {\r\n        desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf ein gutes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      }\r\n    } else if (percentile <= 69) {\r\n      alert_class <- \"alert-info\"\r\n      level <- \"ðŸ‘¤ Durchschnittliches Funktionsniveau\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und entspricht dem durchschnittlichen Bereich der AllgemeinbevÃ¶lkerung.\")\r\n    } else if (percentile <= 93) {\r\n      alert_class <- \"alert-warning\"\r\n      level <- \"ðŸš¶â€â™‚ï¸ Leicht erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und kÃ¶nnte auf leichte Schwierigkeiten im Funktionsniveau hinweisen.\")\r\n    } else {\r\n      alert_class <- \"alert-danger\"\r\n      level <- \"ðŸ§â€â™€ï¸ Deutlich erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf bedeutsame Schwierigkeiten im Funktionsniveau hin.\")\r\n    }\r\n    \r\n    tagList(\r\n      div(class = paste(\"alert\", alert_class),\r\n          h4(level, style = \"margin-bottom: 15px;\"),\r\n          p(desc, style = \"margin-bottom: 0; font-size: 1.05em;\")\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      fluidRow(\r\n        column(6,\r\n               h5(\"ðŸ“‹ Referenzwerte:\"),\r\n               tags$ul(\r\n                 tags$li(\"Tâ‚…â‚€ = 15 Punkte (Durchschnitt)\"),\r\n                 tags$li(\"Tâ‚‡â‚€ = 33 Punkte (klinisch auffÃ¤llig)\")\r\n               )\r\n        ),\r\n        column(6,\r\n               h5(\"ðŸ§â€â™‚ï¸ Ihre Werte:\"),\r\n               tags$ul(\r\n                 tags$li(paste0(\"Selbst-Bereich: \", values$self_score, \"/24\")),\r\n                 tags$li(paste0(\"Interpersonal: \", values$interpersonal_score, \"/24\")),\r\n                 tags$li(paste0(\"Gesamt: \", score, \"/48\"))\r\n               )\r\n        )\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ“Š Methodischer Hinweis: \"), \r\n            \"Die LPFS-BF hat einen Mindestwert von 12 Punkten (bestmÃ¶gliches Ergebnis). Niemand kann niedrigere Werte erreichen. Das bedeutet, dass bei niedrigen Perzentilen nicht alle Prozentangaben unterhalb Ihres Werts liegen, sondern das die Normierung auf der gesamten theoretischen Verteilung basiert. Diese Studie wurde an einer nicht-klinischen Stichprobe durchgefÃ¼hrt.\",\r\n            style = \"margin: 0; color: #6c757d; font-size: 0.9em;\")\r\n      ),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ§â€â™€ï¸ Wichtiger Hinweis: \"), \r\n            \"Diese Auswertung dient ausschlieÃŸlich zu Informations- und Bildungszwecken. Sie ersetzt keine professionelle psychologische Diagnostik oder Beratung. Bei anhaltenden Problemen wenden Sie sich an qualifizierte FachkrÃ¤fte.\",\r\n            style = \"margin: 0; color: #6c757d;\")\r\n      ),\r\n      \r\n      div(style = \"text-align: center; margin-top: 20px;\",\r\n          tags$em(\"Referenz: Spitzer, C. et al. (2021). Psychotherapie - Psychosomatik - Medizinische Psychologie, 71, 284-293.\",\r\n                  style = \"color: #6c757d; font-size: 0.9em;\")\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$your_position <- renderText({\r\n    if (values$calculated) {\r\n      paste0(values$total_score, \" Punkte (T-Wert: \", values$t_value, \")\")\r\n    } else \"\"\r\n  })\r\n  \r\n  # Normalverteilungsbalken generieren - KORRIGIERT fÃ¼r realen T-Wert Bereich (45-82)\r\n  output$normal_distribution_bars <- renderUI({\r\n    # T-Werte von 45 bis 80 (realer Bereich laut Tabelle), alle 2er Schritte\r\n    # T=45 ist MINIMUM (12 Punkte), T=82 ist MAXIMUM (48 Punkte)\r\n    t_values <- seq(45, 79, by = 2)\r\n    \r\n    # Vordefinierte normalisierte HÃ¶hen fÃ¼r T=45-79 (basiert auf dnorm, dann skaliert)\r\n    # Peak bei T=50, abfallend zu den Seiten\r\n    heights <- c(\r\n      69, 80, 92, 105, 117, 129, 139, 148, 150, 148, 139, 129, 117, 105, 92, 80, 69, 55\r\n    )\r\n    \r\n    # Erstelle Balken\r\n    bars <- lapply(1:length(t_values), function(i) {\r\n      t_val <- t_values[i]\r\n      height <- heights[i]\r\n      \r\n      # Bestimme Farbe basierend auf T-Wert-Bereich\r\n      if (t_val <= 45) {\r\n        color <- \"#28a745\"  # GrÃ¼n\r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 55) {\r\n        color <- \"#17a2b8\"  # Blau  \r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 69) {\r\n        color <- \"#ffc107\"  # Gelb\r\n        opacity <- \"0.8\"\r\n      } else {\r\n        color <- \"#dc3545\"  # Rot\r\n        opacity <- \"0.8\"\r\n      }\r\n      \r\n      # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n      position <- 50 + ((t_val - 45) / 34) * 400\r\n      \r\n      div(style = paste0(\r\n        \"position: absolute; \",\r\n        \"left: \", position, \"px; \",\r\n        \"bottom: 25px; \",\r\n        \"width: 15px; \",\r\n        \"height: \", height, \"px; \",\r\n        \"background: \", color, \"; \",\r\n        \"border-radius: 2px 2px 0 0; \",\r\n        \"opacity: \", opacity, \"; \",\r\n        \"transition: all 0.3s ease;\"\r\n      ))\r\n    })\r\n    \r\n    return(tagList(bars))\r\n  })\r\n  \r\n  # Dynamische Positionierung des Benutzerwerts im Verteilungsdiagramm\r\n  output$user_position_marker <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    t_val <- values$t_value\r\n    \r\n    # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n    position <- 50 + ((t_val - 45) / 34) * 400\r\n    \r\n    # Begrenze Position auf sichtbare Bereiche\r\n    position <- max(50, min(450, position))\r\n    \r\n    tagList(\r\n      # Roter Strich\r\n      div(style = paste0(\"position: absolute; left: \", position, \"px; top: 10px; width: 4px; height: 180px; background: #ff0000; border-radius: 2px; box-shadow: 0 0 10px rgba(255,0,0,0.7); z-index: 10;\")),\r\n      # Pfeil nach unten\r\n      div(style = paste0(\"position: absolute; left: \", position-5, \"px; top: 185px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid #ff0000; z-index: 10;\")),\r\n      # Label\r\n      div(style = paste0(\"position: absolute; left: \", position-25, \"px; top: 200px; background: #ff0000; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap; z-index: 10;\"),\r\n          paste0(score, \" Pkt (T\", t_val, \")\")\r\n      )\r\n    )\r\n  })\r\n}\r\n\r\n# App starten\r\nshinyApp(ui = ui, server = server)","type":"text"},{"name":"Archive/app_shinylive.R","content":"# LPFS-BF 2.0 - REPARIERTE MINIMALE VERSION\r\n# Funktioniert garantiert - nur shiny, keine anderen Pakete!\r\n\r\nlibrary(shiny)\r\n\r\n# LPFS-BF Items\r\nitems <- c(\r\n  \"Ich weiÃŸ oft nicht wer ich wirklich bin.\",\r\n  \"Ich denke oft sehr schlecht Ã¼ber mich selbst.\",\r\n  \"Meine GefÃ¼hle Ã¤ndern sich, ohne dass ich sie im Griff habe.\",\r\n  \"Ich habe keine Ahnung, wo ich im Leben hin will.\",\r\n  \"Ich verstehe oft meine eigenen Gedanken und GefÃ¼hle nicht.\",\r\n  \"Ich stelle oft unrealistische Anforderungen an mich selbst.\",\r\n  \"Ich habe oft Schwierigkeiten, die Gedanken und GefÃ¼hle anderer zu verstehen.\",\r\n  \"Ich kann es oft schwer aushalten, wenn andere eine andere Meinung haben.\",\r\n  \"Ich verstehe oft nicht ganz, warum mein Verhalten einen bestimmten Einfluss auf andere hat.\",\r\n  \"Meine Beziehungen und Freundschaften halten nie lange.\",\r\n  \"Ich fÃ¼hle mich oft sehr verletzlich, wenn Beziehungen persÃ¶nlicher werden.\",\r\n  \"Es gelingt mir hÃ¤ufig nicht, mit anderen auf eine Weise zusammen zu arbeiten, die fÃ¼r beide Seiten zufriedenstellend ist.\"\r\n)\r\n\r\n# T-Werte zu Perzentil Konvertierung - KONTINUIERLICH & PRÃ„ZISE\r\ncalculate_percentile <- function(score) {\r\n  t_values <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n  names(t_values) <- 12:48\r\n  \r\n  if (score < 12) return(1)\r\n  if (score > 48) return(99)\r\n  \r\n  t_val <- t_values[as.character(score)]\r\n  if (is.na(t_val)) t_val <- 50\r\n  \r\n  # Kontinuierliche Normalverteilungs-CDF Approximation\r\n  # T-Werte: T = 50 + 10*z, also z = (T-50)/10\r\n  z_score <- (t_val - 50) / 10\r\n  \r\n  # Begrenzen auf sinnvolle Werte\r\n  z_score <- pmax(-3, pmin(3, z_score))\r\n  \r\n  # PrÃ¤zise Approximation der Standard-Normalverteilung CDF\r\n  # Abramowitz & Stegun Approximation (sehr genau)\r\n  if (z_score >= 0) {\r\n    # FÃ¼r positive z-scores\r\n    t <- 1 / (1 + 0.2316419 * z_score)\r\n    d <- 0.3989423 * exp(-z_score * z_score / 2)\r\n    prob <- 1 - d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  } else {\r\n    # FÃ¼r negative z-scores: Î¦(-z) = 1 - Î¦(z)\r\n    z_pos <- -z_score\r\n    t <- 1 / (1 + 0.2316419 * z_pos)\r\n    d <- 0.3989423 * exp(-z_pos * z_pos / 2)\r\n    prob <- d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  }\r\n  \r\n  # Konvertiere zu Perzentil (0-100)\r\n  percentile <- round(prob * 100)\r\n  \r\n  # Sicherstellen dass Werte im sinnvollen Bereich sind\r\n  return(pmax(1, pmin(99, percentile)))\r\n}\r\n\r\n# UI - Nur mit Shiny, kein bslib\r\nui <- fluidPage(\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8f9fa; }\r\n      .container-fluid { max-width: 1000px; margin: 0 auto; padding: 20px; }\r\n      .panel { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }\r\n      .question-item { background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin: 15px 0; transition: all 0.3s ease; }\r\n      .question-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }\r\n      .self-section { border-left: 4px solid #007bff; }\r\n      .interpersonal-section { border-left: 4px solid #28a745; }\r\n      .results-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; }\r\n      .score-card { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 20px; margin: 10px; text-align: center; backdrop-filter: blur(10px); }\r\n      .score-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }\r\n      .score-label { font-size: 1.1em; opacity: 0.9; }\r\n      .btn-primary { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }\r\n      .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,123,255,0.3); }\r\n      .btn-secondary { background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }\r\n      .interpretation-panel { background: white; color: #333; border-radius: 12px; padding: 25px; margin: 20px 0; }\r\n      .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }\r\n      .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }\r\n      .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }\r\n      .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }\r\n      .alert-danger { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }\r\n      .norm-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\r\n      .norm-item { padding: 20px; border-radius: 10px; text-align: center; color: white; font-weight: bold; position: relative; }\r\n      .norm-good { background: linear-gradient(135deg, #28a745, #20c997); }\r\n      .norm-average { background: linear-gradient(135deg, #17a2b8, #20c997); }\r\n      .norm-elevated { background: linear-gradient(135deg, #ffc107, #fd7e14); color: #333; }\r\n      .norm-high { background: linear-gradient(135deg, #dc3545, #e83e8c); }\r\n      .your-score { background: #007bff; color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; font-size: 1.2em; font-weight: bold; }\r\n      h1, h2, h3, h4 { color: #2c3e50; margin-bottom: 15px; }\r\n      .section-title { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 8px; margin-bottom: 20px; }\r\n      .radio-option { margin: 8px 0; }\r\n      @media (max-width: 768px) {\r\n        .container-fluid { padding: 10px; }\r\n        .panel { padding: 15px; margin: 10px 0; }\r\n        .score-number { font-size: 2em; }\r\n        .norm-comparison { grid-template-columns: 1fr 1fr; }\r\n      }\r\n    \"))\r\n  ),\r\n  \r\n  title = \"LPFS-BF 2.0\",\r\n  \r\n  # Header\r\n  div(class = \"panel\",\r\n      h1(\"ðŸ‘¥ LPFS-BF 2.0\", style = \"text-align: center; color: #007bff; margin-bottom: 10px;\"),\r\n      h3(\"Level of Personality Functioning Scale\", style = \"text-align: center; color: #6c757d; font-weight: 300;\"),\r\n      hr(),\r\n      p(\"Diese validierte Skala erfasst das Funktionsniveau der PersÃ¶nlichkeit in zwei Hauptbereichen:\", \r\n        style = \"text-align: center; font-size: 1.1em; color: #666;\"),\r\n      div(style = \"text-align: center; margin: 20px 0;\",\r\n          span(\"ðŸ§â€â™‚ï¸ Selbst-Funktionen (Items 1-6)\", style = \"margin: 0 20px; color: #007bff; font-weight: 500;\"),\r\n          span(\"ðŸ‘¥ Interpersonale Funktionen (Items 7-12)\", style = \"margin: 0 20px; color: #28a745; font-weight: 500;\")\r\n      )\r\n  ),\r\n  \r\n  # Fragebogen\r\n  conditionalPanel(\r\n    condition = \"!output.show_results\",\r\n    div(class = \"panel\",\r\n        h3(\"Fragebogen\", class = \"section-title\"),\r\n        p(\"Bitte geben Sie fÃ¼r jede der folgenden Aussagen an, inwieweit diese zurzeit auf Sie zutrifft:\", \r\n          style = \"font-size: 1.1em; margin-bottom: 30px;\"),\r\n        \r\n        h4(\"ðŸ§â€â™‚ï¸ Selbst-Bereich\", style = \"color: #007bff; margin-top: 30px;\"),\r\n        lapply(1:6, function(i) {\r\n          div(class = \"question-item self-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        h4(\"ðŸ‘¥ Interpersonaler Bereich\", style = \"color: #28a745; margin-top: 40px;\"),\r\n        lapply(7:12, function(i) {\r\n          div(class = \"question-item interpersonal-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        div(style = \"text-align: center; margin: 40px 0;\",\r\n            actionButton(\"calculate\", \"ðŸŽ¯ Ergebnisse berechnen\", class = \"btn-primary\", style = \"width: 300px; height: 55px; font-size: 18px;\")\r\n        )\r\n    )\r\n  ),\r\n  \r\n  # Ergebnisse\r\n  conditionalPanel(\r\n    condition = \"output.show_results\",\r\n    \r\n    # Score Cards\r\n    div(class = \"results-container\",\r\n        h2(\"ðŸ§â€â™‚ï¸ Ihre Ergebnisse\", style = \"text-align: center; margin-bottom: 30px;\"),\r\n        fluidRow(\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"total_score\")),\r\n                        div(class = \"score-label\", \"Gesamtwert (12-48)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"self_score\")),\r\n                        div(class = \"score-label\", \"Selbst-Bereich (6-24)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"interpersonal_score\")),\r\n                        div(class = \"score-label\", \"Interpersonal (6-24)\")\r\n          ))\r\n        ),\r\n        \r\n        # Perzentil\r\n        div(class = \"score-card\", style = \"margin-top: 20px;\",\r\n            div(style = \"font-size: 3em; font-weight: bold;\", \r\n                textOutput(\"percentile\", inline = TRUE), \r\n                span(\"%\", style = \"color: #ffd700;\")\r\n            ),\r\n            div(class = \"score-label\", \"Perzentil in der deutschen BevÃ¶lkerung\"),\r\n            div(style = \"margin-top: 10px; font-size: 1.1em;\",\r\n                \"T-Wert: \", textOutput(\"t_value\", inline = TRUE)\r\n            )\r\n        )\r\n    ),\r\n    \r\n    # Interpretation\r\n    div(class = \"interpretation-panel\",\r\n        h3(\"ðŸ§â€â™€ï¸ Interpretation\", class = \"section-title\"),\r\n        uiOutput(\"interpretation\")\r\n    ),\r\n    \r\n    # Normvergleich mit Normalverteilungs-Dichtefunktion\r\n    div(class = \"panel\",\r\n        h3(\"ðŸ“Š Normvergleich\", class = \"section-title\"),\r\n        p(\"Ihre Position in der deutschen AllgemeinbevÃ¶lkerung (realer T-Wert-Bereich: 45-82):\", \r\n          style = \"margin-bottom: 15px;\"),\r\n        p(tags$em(\"Spitzer et al., 2021, n=2.470 â€¢ Nicht-klinische Stichprobe\"), \r\n          style = \"margin-bottom: 25px; color: #666; font-size: 0.9em;\"),\r\n        \r\n        # Normalverteilungsdiagramm mit vielen schmalen Balken\r\n        div(style = \"position: relative; height: 250px; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); border-radius: 10px; margin: 30px 0; padding: 20px; overflow: hidden;\",\r\n            \r\n            # JavaScript fÃ¼r dynamische Balkenerstellung (wird im Server generiert)\r\n            uiOutput(\"normal_distribution_bars\"),\r\n            \r\n            # Ihr Wert als roter Strich (wird dynamisch positioniert)\r\n            uiOutput(\"user_position_marker\"),\r\n            \r\n            # X-Achsen-Beschriftung (angepasst fÃ¼r realen T-Wert Bereich)\r\n            div(style = \"position: absolute; bottom: 5px; left: 50px; font-size: 12px; color: #666;\", \"T=45\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 150px; font-size: 12px; color: #666;\", \"T=55\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 250px; font-size: 12px; color: #666;\", \"T=65\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 350px; font-size: 12px; color: #666;\", \"T=75\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 450px; font-size: 12px; color: #666;\", \"T=82\"),\r\n            \r\n            # Hinweis auf Minimum\r\n            div(style = \"position: absolute; top: 10px; left: 50px; font-size: 11px; color: #28a745; font-weight: bold;\", \"MINIMUM\"),\r\n        ),\r\n        \r\n        # Legende (aktualisiert fÃ¼r realen T-Wert Bereich)\r\n        div(style = \"margin-top: 20px; text-align: center;\",\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #28a745; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"BestmÃ¶glich (T=45)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #17a2b8; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Durchschnitt (T46-55)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #ffc107; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"ErhÃ¶ht (T56-69)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #dc3545; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Hoch (Tâ‰¥70)\", style = \"font-size: 14px;\")\r\n            )\r\n        ),\r\n        \r\n        div(class = \"your-score\",\r\n            \"ðŸŽ¯ Ihr Wert: \", textOutput(\"your_position\", inline = TRUE)\r\n        )\r\n    ),\r\n    \r\n    div(style = \"text-align: center; margin: 30px 0;\",\r\n        actionButton(\"reset\", \"ðŸ”„ Neue Umfrage starten\", class = \"btn-secondary\")\r\n    )\r\n  )\r\n)\r\n\r\n# Server\r\nserver <- function(input, output, session) {\r\n  values <- reactiveValues(calculated = FALSE)\r\n  \r\n  observeEvent(input$calculate, {\r\n    # Sammle alle Antworten\r\n    all_items <- sapply(1:12, function(i) input[[paste0(\"item_\", i)]])\r\n    \r\n    # PrÃ¼fe ob alle beantwortet\r\n    if (any(sapply(all_items, is.null))) {\r\n      # Validation message will be shown in UI instead of notification\r\n      return()\r\n    }\r\n    \r\n    # Berechne Scores\r\n    scores <- as.numeric(all_items)\r\n    values$self_score <- sum(scores[1:6])\r\n    values$interpersonal_score <- sum(scores[7:12])\r\n    values$total_score <- values$self_score + values$interpersonal_score\r\n    values$percentile <- calculate_percentile(values$total_score)\r\n    \r\n    # T-Wert aus Tabelle\r\n    t_vals <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n    names(t_vals) <- 12:48\r\n    values$t_value <- t_vals[as.character(values$total_score)]\r\n    if (is.na(values$t_value)) values$t_value <- 50\r\n    \r\n    values$calculated <- TRUE\r\n    # Success message will be shown in UI instead of notification\r\n  })\r\n  \r\n  observeEvent(input$reset, {\r\n    # Alle Inputs zurÃ¼cksetzen\r\n    lapply(1:12, function(i) {\r\n      updateRadioButtons(session, paste0(\"item_\", i), selected = character(0))\r\n    })\r\n    values$calculated <- FALSE\r\n    # Reset message will be shown in UI instead of notification\r\n  })\r\n  \r\n  # Outputs\r\n  output$show_results <- reactive({ values$calculated })\r\n  outputOptions(output, \"show_results\", suspendWhenHidden = FALSE)\r\n  \r\n  output$total_score <- renderText({\r\n    if (values$calculated) as.character(values$total_score) else \"\"\r\n  })\r\n  \r\n  output$self_score <- renderText({\r\n    if (values$calculated) as.character(values$self_score) else \"\"\r\n  })\r\n  \r\n  output$interpersonal_score <- renderText({\r\n    if (values$calculated) as.character(values$interpersonal_score) else \"\"\r\n  })\r\n  \r\n  output$percentile <- renderText({\r\n    if (values$calculated) as.character(values$percentile) else \"\"\r\n  })\r\n  \r\n  output$t_value <- renderText({\r\n    if (values$calculated) as.character(values$t_value) else \"\"\r\n  })\r\n  \r\n  output$interpretation <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    percentile <- values$percentile\r\n    t_val <- values$t_value\r\n    \r\n    # Interpretation basierend auf Perzentilen - MIT METHODISCHEN HINWEISEN\r\n    if (percentile <= 31) {\r\n      alert_class <- \"alert-success\"\r\n      level <- \"ðŸ§â€â™‚ï¸ Gutes Funktionsniveau\"\r\n      if (score == 12) {\r\n        desc <- paste0(\"Sie haben das bestmÃ¶gliche Ergebnis erreicht (\", score, \" Punkte, T-Wert: \", t_val, \"). Dies ist der niedrigstmÃ¶gliche Wert und deutet auf ein ausgezeichnetes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      } else {\r\n        desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf ein gutes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      }\r\n    } else if (percentile <= 69) {\r\n      alert_class <- \"alert-info\"\r\n      level <- \"ðŸ‘¤ Durchschnittliches Funktionsniveau\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und entspricht dem durchschnittlichen Bereich der AllgemeinbevÃ¶lkerung.\")\r\n    } else if (percentile <= 93) {\r\n      alert_class <- \"alert-warning\"\r\n      level <- \"ðŸš¶â€â™‚ï¸ Leicht erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und kÃ¶nnte auf leichte Schwierigkeiten im Funktionsniveau hinweisen.\")\r\n    } else {\r\n      alert_class <- \"alert-danger\"\r\n      level <- \"ðŸ§â€â™€ï¸ Deutlich erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf bedeutsame Schwierigkeiten im Funktionsniveau hin.\")\r\n    }\r\n    \r\n    tagList(\r\n      div(class = paste(\"alert\", alert_class),\r\n          h4(level, style = \"margin-bottom: 15px;\"),\r\n          p(desc, style = \"margin-bottom: 0; font-size: 1.05em;\")\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      fluidRow(\r\n        column(6,\r\n               h5(\"ðŸ“‹ Referenzwerte:\"),\r\n               tags$ul(\r\n                 tags$li(\"Tâ‚…â‚€ = 15 Punkte (Durchschnitt)\"),\r\n                 tags$li(\"Tâ‚‡â‚€ = 33 Punkte (klinisch auffÃ¤llig)\")\r\n               )\r\n        ),\r\n        column(6,\r\n               h5(\"ðŸ§â€â™‚ï¸ Ihre Werte:\"),\r\n               tags$ul(\r\n                 tags$li(paste0(\"Selbst-Bereich: \", values$self_score, \"/24\")),\r\n                 tags$li(paste0(\"Interpersonal: \", values$interpersonal_score, \"/24\")),\r\n                 tags$li(paste0(\"Gesamt: \", score, \"/48\"))\r\n               )\r\n        )\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ“Š Methodischer Hinweis: \"), \r\n            \"Die LPFS-BF hat einen Mindestwert von 12 Punkten (bestmÃ¶gliches Ergebnis). Niemand kann niedrigere Werte erreichen. Das bedeutet, dass bei niedrigen Perzentilen nicht alle Prozentangaben unterhalb Ihres Werts liegen, sondern das die Normierung auf der gesamten theoretischen Verteilung basiert. Diese Studie wurde an einer nicht-klinischen Stichprobe durchgefÃ¼hrt.\",\r\n            style = \"margin: 0; color: #6c757d; font-size: 0.9em;\")\r\n      ),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ§â€â™€ï¸ Wichtiger Hinweis: \"), \r\n            \"Diese Auswertung dient ausschlieÃŸlich zu Informations- und Bildungszwecken. Sie ersetzt keine professionelle psychologische Diagnostik oder Beratung. Bei anhaltenden Problemen wenden Sie sich an qualifizierte FachkrÃ¤fte.\",\r\n            style = \"margin: 0; color: #6c757d;\")\r\n      ),\r\n      \r\n      div(style = \"text-align: center; margin-top: 20px;\",\r\n          tags$em(\"Referenz: Spitzer, C. et al. (2021). Psychotherapie - Psychosomatik - Medizinische Psychologie, 71, 284-293.\",\r\n                  style = \"color: #6c757d; font-size: 0.9em;\")\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$your_position <- renderText({\r\n    if (values$calculated) {\r\n      paste0(values$total_score, \" Punkte (T-Wert: \", values$t_value, \")\")\r\n    } else \"\"\r\n  })\r\n  \r\n  # Normalverteilungsbalken generieren - KORRIGIERT fÃ¼r realen T-Wert Bereich (45-82)\r\n  output$normal_distribution_bars <- renderUI({\r\n    # T-Werte von 45 bis 80 (realer Bereich laut Tabelle), alle 2er Schritte\r\n    # T=45 ist MINIMUM (12 Punkte), T=82 ist MAXIMUM (48 Punkte)\r\n    t_values <- seq(45, 79, by = 2)\r\n    \r\n    # Vordefinierte normalisierte HÃ¶hen fÃ¼r T=45-79 (basiert auf dnorm, dann skaliert)\r\n    # Peak bei T=50, abfallend zu den Seiten\r\n    heights <- c(\r\n      69, 80, 92, 105, 117, 129, 139, 148, 150, 148, 139, 129, 117, 105, 92, 80, 69, 55\r\n    )\r\n    \r\n    # Erstelle Balken\r\n    bars <- lapply(1:length(t_values), function(i) {\r\n      t_val <- t_values[i]\r\n      height <- heights[i]\r\n      \r\n      # Bestimme Farbe basierend auf T-Wert-Bereich\r\n      if (t_val <= 45) {\r\n        color <- \"#28a745\"  # GrÃ¼n\r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 55) {\r\n        color <- \"#17a2b8\"  # Blau  \r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 69) {\r\n        color <- \"#ffc107\"  # Gelb\r\n        opacity <- \"0.8\"\r\n      } else {\r\n        color <- \"#dc3545\"  # Rot\r\n        opacity <- \"0.8\"\r\n      }\r\n      \r\n      # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n      position <- 50 + ((t_val - 45) / 34) * 400\r\n      \r\n      div(style = paste0(\r\n        \"position: absolute; \",\r\n        \"left: \", position, \"px; \",\r\n        \"bottom: 25px; \",\r\n        \"width: 15px; \",\r\n        \"height: \", height, \"px; \",\r\n        \"background: \", color, \"; \",\r\n        \"border-radius: 2px 2px 0 0; \",\r\n        \"opacity: \", opacity, \"; \",\r\n        \"transition: all 0.3s ease;\"\r\n      ))\r\n    })\r\n    \r\n    return(tagList(bars))\r\n  })\r\n  \r\n  # Dynamische Positionierung des Benutzerwerts im Verteilungsdiagramm\r\n  output$user_position_marker <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    t_val <- values$t_value\r\n    \r\n    # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n    position <- 50 + ((t_val - 45) / 34) * 400\r\n    \r\n    # Begrenze Position auf sichtbare Bereiche\r\n    position <- max(50, min(450, position))\r\n    \r\n    tagList(\r\n      # Roter Strich\r\n      div(style = paste0(\"position: absolute; left: \", position, \"px; top: 10px; width: 4px; height: 180px; background: #ff0000; border-radius: 2px; box-shadow: 0 0 10px rgba(255,0,0,0.7); z-index: 10;\")),\r\n      # Pfeil nach unten\r\n      div(style = paste0(\"position: absolute; left: \", position-5, \"px; top: 185px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid #ff0000; z-index: 10;\")),\r\n      # Label\r\n      div(style = paste0(\"position: absolute; left: \", position-25, \"px; top: 200px; background: #ff0000; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap; z-index: 10;\"),\r\n          paste0(score, \" Pkt (T\", t_val, \")\")\r\n      )\r\n    )\r\n  })\r\n}\r\n\r\n# App starten\r\nshinyApp(ui = ui, server = server)\r\n","type":"text"},{"name":"Archive/app_test_simple.R","content":"library(shiny)\r\n\r\n# Simplified LPFS-BF test version for shinylive compatibility testing\r\nui <- fluidPage(\r\n  titlePanel('LPFS-BF Compatibility Test'),\r\n  \r\n  # State-driven UI without conditionalPanel or showNotification\r\n  uiOutput('main_interface')\r\n)\r\n\r\nserver <- function(input, output, session) {\r\n  # State management using reactiveValues\r\n  values <- reactiveValues(show_results = FALSE)\r\n  \r\n  # Main interface renderer (replaces conditionalPanel logic)\r\n  output$main_interface <- renderUI({\r\n    if (values$show_results) {\r\n      # Results view\r\n      tagList(\r\n        h3('Test Results View'),\r\n        p('This demonstrates the results interface'),\r\n        actionButton('back', 'Back to Questionnaire')\r\n      )\r\n    } else {\r\n      # Questionnaire view\r\n      tagList(\r\n        h3('Test Questionnaire View'),\r\n        p('This demonstrates the questionnaire interface'),\r\n        actionButton('calculate', 'Show Results')\r\n      )\r\n    }\r\n  })\r\n  \r\n  # Event handlers for state transitions\r\n  observeEvent(input$calculate, {\r\n    values$show_results <- TRUE\r\n  })\r\n  \r\n  observeEvent(input$back, {\r\n    values$show_results <- FALSE\r\n  })\r\n}\r\n\r\nshinyApp(ui = ui, server = server)\r\n","type":"text"},{"name":"Archive/app_ultra_minimal.R","content":"library(shiny)\r\n\r\n# Ultra-minimale Shiny-App fÃ¼r shinylive KompatibilitÃ¤tstest\r\nui <- fluidPage(\r\n  h1('Minimal Test App'),\r\n  p('Dies ist ein Test fÃ¼r shinylive KompatibilitÃ¤t'),\r\n  textOutput('simple_text')\r\n)\r\n\r\nserver <- function(input, output, session) {\r\n  output$simple_text <- renderText({\r\n    'Diese App funktioniert!'\r\n  })\r\n}\r\n\r\nshinyApp(ui = ui, server = server)\r\n","type":"text"},{"name":"DESCRIPTION.txt","content":"Package: LPFSApp\r\nType: Project\r\nTitle: LPFS-BF 2.0 ShinyLive Bundle\r\nVersion: 1.0.0\r\nImports:\r\n    shiny,\r\n    shinylive\r\n","type":"text"},{"name":"LPFS_app.R","content":"# LPFS-BF 2.0 - REPARIERTE MINIMALE VERSION\r\n# Funktioniert garantiert - nur shiny, keine anderen Pakete!\r\n\r\nlibrary(shiny)\r\n\r\n# LPFS-BF Items\r\nitems <- c(\r\n  \"Ich weiÃŸ oft nicht wer ich wirklich bin.\",\r\n  \"Ich denke oft sehr schlecht Ã¼ber mich selbst.\",\r\n  \"Meine GefÃ¼hle Ã¤ndern sich, ohne dass ich sie im Griff habe.\",\r\n  \"Ich habe keine Ahnung, wo ich im Leben hin will.\",\r\n  \"Ich verstehe oft meine eigenen Gedanken und GefÃ¼hle nicht.\",\r\n  \"Ich stelle oft unrealistische Anforderungen an mich selbst.\",\r\n  \"Ich habe oft Schwierigkeiten, die Gedanken und GefÃ¼hle anderer zu verstehen.\",\r\n  \"Ich kann es oft schwer aushalten, wenn andere eine andere Meinung haben.\",\r\n  \"Ich verstehe oft nicht ganz, warum mein Verhalten einen bestimmten Einfluss auf andere hat.\",\r\n  \"Meine Beziehungen und Freundschaften halten nie lange.\",\r\n  \"Ich fÃ¼hle mich oft sehr verletzlich, wenn Beziehungen persÃ¶nlicher werden.\",\r\n  \"Es gelingt mir hÃ¤ufig nicht, mit anderen auf eine Weise zusammen zu arbeiten, die fÃ¼r beide Seiten zufriedenstellend ist.\"\r\n)\r\n\r\n# T-Werte zu Perzentil Konvertierung - KONTINUIERLICH & PRÃ„ZISE\r\ncalculate_percentile <- function(score) {\r\n  t_values <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n  names(t_values) <- 12:48\r\n  \r\n  if (score < 12) return(1)\r\n  if (score > 48) return(99)\r\n  \r\n  t_val <- t_values[as.character(score)]\r\n  if (is.na(t_val)) t_val <- 50\r\n  \r\n  # Kontinuierliche Normalverteilungs-CDF Approximation\r\n  # T-Werte: T = 50 + 10*z, also z = (T-50)/10\r\n  z_score <- (t_val - 50) / 10\r\n  \r\n  # Begrenzen auf sinnvolle Werte\r\n  z_score <- pmax(-3, pmin(3, z_score))\r\n  \r\n  # PrÃ¤zise Approximation der Standard-Normalverteilung CDF\r\n  # Abramowitz & Stegun Approximation (sehr genau)\r\n  if (z_score >= 0) {\r\n    # FÃ¼r positive z-scores\r\n    t <- 1 / (1 + 0.2316419 * z_score)\r\n    d <- 0.3989423 * exp(-z_score * z_score / 2)\r\n    prob <- 1 - d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  } else {\r\n    # FÃ¼r negative z-scores: Î¦(-z) = 1 - Î¦(z)\r\n    z_pos <- -z_score\r\n    t <- 1 / (1 + 0.2316419 * z_pos)\r\n    d <- 0.3989423 * exp(-z_pos * z_pos / 2)\r\n    prob <- d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))))\r\n  }\r\n  \r\n  # Konvertiere zu Perzentil (0-100)\r\n  percentile <- round(prob * 100)\r\n  \r\n  # Sicherstellen dass Werte im sinnvollen Bereich sind\r\n  return(pmax(1, pmin(99, percentile)))\r\n}\r\n\r\n# UI - Nur mit Shiny, kein bslib\r\nui <- fluidPage(\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8f9fa; }\r\n      .container-fluid { max-width: 1000px; margin: 0 auto; padding: 20px; }\r\n      .panel { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }\r\n      .question-item { background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin: 15px 0; transition: all 0.3s ease; }\r\n      .question-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }\r\n      .self-section { border-left: 4px solid #007bff; }\r\n      .interpersonal-section { border-left: 4px solid #28a745; }\r\n      .results-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; }\r\n      .score-card { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 20px; margin: 10px; text-align: center; backdrop-filter: blur(10px); }\r\n      .score-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }\r\n      .score-label { font-size: 1.1em; opacity: 0.9; }\r\n      .btn-primary { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }\r\n      .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,123,255,0.3); }\r\n      .btn-secondary { background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }\r\n      .interpretation-panel { background: white; color: #333; border-radius: 12px; padding: 25px; margin: 20px 0; }\r\n      .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }\r\n      .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }\r\n      .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }\r\n      .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }\r\n      .alert-danger { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }\r\n      .norm-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\r\n      .norm-item { padding: 20px; border-radius: 10px; text-align: center; color: white; font-weight: bold; position: relative; }\r\n      .norm-good { background: linear-gradient(135deg, #28a745, #20c997); }\r\n      .norm-average { background: linear-gradient(135deg, #17a2b8, #20c997); }\r\n      .norm-elevated { background: linear-gradient(135deg, #ffc107, #fd7e14); color: #333; }\r\n      .norm-high { background: linear-gradient(135deg, #dc3545, #e83e8c); }\r\n      .your-score { background: #007bff; color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; font-size: 1.2em; font-weight: bold; }\r\n      h1, h2, h3, h4 { color: #2c3e50; margin-bottom: 15px; }\r\n      .section-title { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 8px; margin-bottom: 20px; }\r\n      .radio-option { margin: 8px 0; }\r\n      @media (max-width: 768px) {\r\n        .container-fluid { padding: 10px; }\r\n        .panel { padding: 15px; margin: 10px 0; }\r\n        .score-number { font-size: 2em; }\r\n        .norm-comparison { grid-template-columns: 1fr 1fr; }\r\n      }\r\n    \"))\r\n  ),\r\n  \r\n  title = \"LPFS-BF 2.0\",\r\n  \r\n  # Header\r\n  div(class = \"panel\",\r\n      h1(\"ðŸ‘¥ LPFS-BF 2.0\", style = \"text-align: center; color: #007bff; margin-bottom: 10px;\"),\r\n      h3(\"Level of Personality Functioning Scale\", style = \"text-align: center; color: #6c757d; font-weight: 300;\"),\r\n      hr(),\r\n      p(\"Diese validierte Skala erfasst das Funktionsniveau der PersÃ¶nlichkeit in zwei Hauptbereichen:\", \r\n        style = \"text-align: center; font-size: 1.1em; color: #666;\"),\r\n      div(style = \"text-align: center; margin: 20px 0;\",\r\n          span(\"ðŸ§â€â™‚ï¸ Selbst-Funktionen (Items 1-6)\", style = \"margin: 0 20px; color: #007bff; font-weight: 500;\"),\r\n          span(\"ðŸ‘¥ Interpersonale Funktionen (Items 7-12)\", style = \"margin: 0 20px; color: #28a745; font-weight: 500;\")\r\n      )\r\n  ),\r\n  \r\n  # Fragebogen\r\n  conditionalPanel(\r\n    condition = \"!output.show_results\",\r\n    div(class = \"panel\",\r\n        h3(\"Fragebogen\", class = \"section-title\"),\r\n        p(\"Bitte geben Sie fÃ¼r jede der folgenden Aussagen an, inwieweit diese zurzeit auf Sie zutrifft:\", \r\n          style = \"font-size: 1.1em; margin-bottom: 30px;\"),\r\n        \r\n        h4(\"ðŸ§â€â™‚ï¸ Selbst-Bereich\", style = \"color: #007bff; margin-top: 30px;\"),\r\n        lapply(1:6, function(i) {\r\n          div(class = \"question-item self-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        h4(\"ðŸ‘¥ Interpersonaler Bereich\", style = \"color: #28a745; margin-top: 40px;\"),\r\n        lapply(7:12, function(i) {\r\n          div(class = \"question-item interpersonal-section\",\r\n              h5(paste0(i, \". \", items[i]), style = \"color: #2c3e50; margin-bottom: 15px;\"),\r\n              radioButtons(\r\n                inputId = paste0(\"item_\", i),\r\n                label = NULL,\r\n                choices = list(\r\n                  \"Trifft Ã¼berhaupt nicht zu\" = 1,\r\n                  \"Trifft eher nicht zu\" = 2,\r\n                  \"Trifft eher zu\" = 3,\r\n                  \"Trifft genau zu\" = 4\r\n                ),\r\n                selected = character(0)\r\n              )\r\n          )\r\n        }),\r\n        \r\n        div(style = \"text-align: center; margin: 40px 0;\",\r\n            actionButton(\"calculate\", \"ðŸŽ¯ Ergebnisse berechnen\", class = \"btn-primary\", style = \"width: 300px; height: 55px; font-size: 18px;\")\r\n        )\r\n    )\r\n  ),\r\n  \r\n  # Ergebnisse\r\n  conditionalPanel(\r\n    condition = \"output.show_results\",\r\n    \r\n    # Score Cards\r\n    div(class = \"results-container\",\r\n        h2(\"ðŸ§â€â™‚ï¸ Ihre Ergebnisse\", style = \"text-align: center; margin-bottom: 30px;\"),\r\n        fluidRow(\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"total_score\")),\r\n                        div(class = \"score-label\", \"Gesamtwert (12-48)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"self_score\")),\r\n                        div(class = \"score-label\", \"Selbst-Bereich (6-24)\")\r\n          )),\r\n          column(4, div(class = \"score-card\",\r\n                        div(class = \"score-number\", textOutput(\"interpersonal_score\")),\r\n                        div(class = \"score-label\", \"Interpersonal (6-24)\")\r\n          ))\r\n        ),\r\n        \r\n        # Perzentil\r\n        div(class = \"score-card\", style = \"margin-top: 20px;\",\r\n            div(style = \"font-size: 3em; font-weight: bold;\", \r\n                textOutput(\"percentile\", inline = TRUE), \r\n                span(\"%\", style = \"color: #ffd700;\")\r\n            ),\r\n            div(class = \"score-label\", \"Perzentil in der deutschen BevÃ¶lkerung\"),\r\n            div(style = \"margin-top: 10px; font-size: 1.1em;\",\r\n                \"T-Wert: \", textOutput(\"t_value\", inline = TRUE)\r\n            )\r\n        )\r\n    ),\r\n    \r\n    # Interpretation\r\n    div(class = \"interpretation-panel\",\r\n        h3(\"ðŸ§â€â™€ï¸ Interpretation\", class = \"section-title\"),\r\n        uiOutput(\"interpretation\")\r\n    ),\r\n    \r\n    # Normvergleich mit Normalverteilungs-Dichtefunktion\r\n    div(class = \"panel\",\r\n        h3(\"ðŸ“Š Normvergleich\", class = \"section-title\"),\r\n        p(\"Ihre Position in der deutschen AllgemeinbevÃ¶lkerung (realer T-Wert-Bereich: 45-82):\", \r\n          style = \"margin-bottom: 15px;\"),\r\n        p(tags$em(\"Spitzer et al., 2021, n=2.470 â€¢ Nicht-klinische Stichprobe\"), \r\n          style = \"margin-bottom: 25px; color: #666; font-size: 0.9em;\"),\r\n        \r\n        # Normalverteilungsdiagramm mit vielen schmalen Balken\r\n        div(style = \"position: relative; height: 250px; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); border-radius: 10px; margin: 30px 0; padding: 20px; overflow: hidden;\",\r\n            \r\n            # JavaScript fÃ¼r dynamische Balkenerstellung (wird im Server generiert)\r\n            uiOutput(\"normal_distribution_bars\"),\r\n            \r\n            # Ihr Wert als roter Strich (wird dynamisch positioniert)\r\n            uiOutput(\"user_position_marker\"),\r\n            \r\n            # X-Achsen-Beschriftung (angepasst fÃ¼r realen T-Wert Bereich)\r\n            div(style = \"position: absolute; bottom: 5px; left: 50px; font-size: 12px; color: #666;\", \"T=45\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 150px; font-size: 12px; color: #666;\", \"T=55\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 250px; font-size: 12px; color: #666;\", \"T=65\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 350px; font-size: 12px; color: #666;\", \"T=75\"),\r\n            div(style = \"position: absolute; bottom: 5px; left: 450px; font-size: 12px; color: #666;\", \"T=82\"),\r\n            \r\n            # Hinweis auf Minimum\r\n            div(style = \"position: absolute; top: 10px; left: 50px; font-size: 11px; color: #28a745; font-weight: bold;\", \"MINIMUM\"),\r\n        ),\r\n        \r\n        # Legende (aktualisiert fÃ¼r realen T-Wert Bereich)\r\n        div(style = \"margin-top: 20px; text-align: center;\",\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #28a745; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"BestmÃ¶glich (T=45)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #17a2b8; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Durchschnitt (T46-55)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #ffc107; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"ErhÃ¶ht (T56-69)\", style = \"font-size: 14px;\")\r\n            ),\r\n            div(style = \"display: inline-block; margin: 0 15px;\",\r\n                span(style = \"display: inline-block; width: 15px; height: 15px; background: #dc3545; margin-right: 5px; vertical-align: middle;\"),\r\n                span(\"Hoch (Tâ‰¥70)\", style = \"font-size: 14px;\")\r\n            )\r\n        ),\r\n        \r\n        div(class = \"your-score\",\r\n            \"ðŸŽ¯ Ihr Wert: \", textOutput(\"your_position\", inline = TRUE)\r\n        )\r\n    ),\r\n    \r\n    div(style = \"text-align: center; margin: 30px 0;\",\r\n        actionButton(\"reset\", \"ðŸ”„ Neue Umfrage starten\", class = \"btn-secondary\")\r\n    )\r\n  )\r\n)\r\n\r\n# Server\r\nserver <- function(input, output, session) {\r\n  values <- reactiveValues(calculated = FALSE)\r\n  \r\n  observeEvent(input$calculate, {\r\n    # Sammle alle Antworten\r\n    all_items <- sapply(1:12, function(i) input[[paste0(\"item_\", i)]])\r\n    \r\n    # PrÃ¼fe ob alle beantwortet\r\n    if (any(sapply(all_items, is.null))) {\r\n      showNotification(\"ðŸ§â€â™‚ï¸ Bitte beantworten Sie alle 12 Fragen!\", type = \"warning\")\r\n      return()\r\n    }\r\n    \r\n    # Berechne Scores\r\n    scores <- as.numeric(all_items)\r\n    values$self_score <- sum(scores[1:6])\r\n    values$interpersonal_score <- sum(scores[7:12])\r\n    values$total_score <- values$self_score + values$interpersonal_score\r\n    values$percentile <- calculate_percentile(values$total_score)\r\n    \r\n    # T-Wert aus Tabelle\r\n    t_vals <- c(45, 46, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 72, 72, 74, 75, 76, 78, 78, 79, 80, 82, 82, 82, 82, 82, 82)\r\n    names(t_vals) <- 12:48\r\n    values$t_value <- t_vals[as.character(values$total_score)]\r\n    if (is.na(values$t_value)) values$t_value <- 50\r\n    \r\n    values$calculated <- TRUE\r\n    showNotification(\"ðŸŽ¯ Ergebnisse erfolgreich berechnet!\", type = \"message\")\r\n  })\r\n  \r\n  observeEvent(input$reset, {\r\n    # Alle Inputs zurÃ¼cksetzen\r\n    lapply(1:12, function(i) {\r\n      updateRadioButtons(session, paste0(\"item_\", i), selected = character(0))\r\n    })\r\n    values$calculated <- FALSE\r\n    showNotification(\"ðŸ‘¥ Fragebogen wurde zurÃ¼ckgesetzt\", type = \"message\")\r\n  })\r\n  \r\n  # Outputs\r\n  output$show_results <- reactive({ values$calculated })\r\n  outputOptions(output, \"show_results\", suspendWhenHidden = FALSE)\r\n  \r\n  output$total_score <- renderText({\r\n    if (values$calculated) as.character(values$total_score) else \"\"\r\n  })\r\n  \r\n  output$self_score <- renderText({\r\n    if (values$calculated) as.character(values$self_score) else \"\"\r\n  })\r\n  \r\n  output$interpersonal_score <- renderText({\r\n    if (values$calculated) as.character(values$interpersonal_score) else \"\"\r\n  })\r\n  \r\n  output$percentile <- renderText({\r\n    if (values$calculated) as.character(values$percentile) else \"\"\r\n  })\r\n  \r\n  output$t_value <- renderText({\r\n    if (values$calculated) as.character(values$t_value) else \"\"\r\n  })\r\n  \r\n  output$interpretation <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    percentile <- values$percentile\r\n    t_val <- values$t_value\r\n    \r\n    # Interpretation basierend auf Perzentilen - MIT METHODISCHEN HINWEISEN\r\n    if (percentile <= 31) {\r\n      alert_class <- \"alert-success\"\r\n      level <- \"ðŸ§â€â™‚ï¸ Gutes Funktionsniveau\"\r\n      if (score == 12) {\r\n        desc <- paste0(\"Sie haben das bestmÃ¶gliche Ergebnis erreicht (\", score, \" Punkte, T-Wert: \", t_val, \"). Dies ist der niedrigstmÃ¶gliche Wert und deutet auf ein ausgezeichnetes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      } else {\r\n        desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf ein gutes Funktionsniveau der PersÃ¶nlichkeit hin.\")\r\n      }\r\n    } else if (percentile <= 69) {\r\n      alert_class <- \"alert-info\"\r\n      level <- \"ðŸ‘¤ Durchschnittliches Funktionsniveau\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und entspricht dem durchschnittlichen Bereich der AllgemeinbevÃ¶lkerung.\")\r\n    } else if (percentile <= 93) {\r\n      alert_class <- \"alert-warning\"\r\n      level <- \"ðŸš¶â€â™‚ï¸ Leicht erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und kÃ¶nnte auf leichte Schwierigkeiten im Funktionsniveau hinweisen.\")\r\n    } else {\r\n      alert_class <- \"alert-danger\"\r\n      level <- \"ðŸ§â€â™€ï¸ Deutlich erhÃ¶hte Werte\"\r\n      desc <- paste0(\"Ihr Wert von \", score, \" Punkten (T-Wert: \", t_val, \") liegt im \", percentile, \". Perzentil und deutet auf bedeutsame Schwierigkeiten im Funktionsniveau hin.\")\r\n    }\r\n    \r\n    tagList(\r\n      div(class = paste(\"alert\", alert_class),\r\n          h4(level, style = \"margin-bottom: 15px;\"),\r\n          p(desc, style = \"margin-bottom: 0; font-size: 1.05em;\")\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      fluidRow(\r\n        column(6,\r\n               h5(\"ðŸ“‹ Referenzwerte:\"),\r\n               tags$ul(\r\n                 tags$li(\"Tâ‚…â‚€ = 15 Punkte (Durchschnitt)\"),\r\n                 tags$li(\"Tâ‚‡â‚€ = 33 Punkte (klinisch auffÃ¤llig)\")\r\n               )\r\n        ),\r\n        column(6,\r\n               h5(\"ðŸ§â€â™‚ï¸ Ihre Werte:\"),\r\n               tags$ul(\r\n                 tags$li(paste0(\"Selbst-Bereich: \", values$self_score, \"/24\")),\r\n                 tags$li(paste0(\"Interpersonal: \", values$interpersonal_score, \"/24\")),\r\n                 tags$li(paste0(\"Gesamt: \", score, \"/48\"))\r\n               )\r\n        )\r\n      ),\r\n      \r\n      hr(),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ“Š Methodischer Hinweis: \"), \r\n            \"Die LPFS-BF hat einen Mindestwert von 12 Punkten (bestmÃ¶gliches Ergebnis). Niemand kann niedrigere Werte erreichen. Das bedeutet, dass bei niedrigen Perzentilen nicht alle Prozentangaben unterhalb Ihres Werts liegen, sondern das die Normierung auf der gesamten theoretischen Verteilung basiert. Diese Studie wurde an einer nicht-klinischen Stichprobe durchgefÃ¼hrt.\",\r\n            style = \"margin: 0; color: #6c757d; font-size: 0.9em;\")\r\n      ),\r\n      \r\n      div(style = \"background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;\",\r\n          p(tags$strong(\"ðŸ§â€â™€ï¸ Wichtiger Hinweis: \"), \r\n            \"Diese Auswertung dient ausschlieÃŸlich zu Informations- und Bildungszwecken. Sie ersetzt keine professionelle psychologische Diagnostik oder Beratung. Bei anhaltenden Problemen wenden Sie sich an qualifizierte FachkrÃ¤fte.\",\r\n            style = \"margin: 0; color: #6c757d;\")\r\n      ),\r\n      \r\n      div(style = \"text-align: center; margin-top: 20px;\",\r\n          tags$em(\"Referenz: Spitzer, C. et al. (2021). Psychotherapie - Psychosomatik - Medizinische Psychologie, 71, 284-293.\",\r\n                  style = \"color: #6c757d; font-size: 0.9em;\")\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$your_position <- renderText({\r\n    if (values$calculated) {\r\n      paste0(values$total_score, \" Punkte (T-Wert: \", values$t_value, \")\")\r\n    } else \"\"\r\n  })\r\n  \r\n  # Normalverteilungsbalken generieren - KORRIGIERT fÃ¼r realen T-Wert Bereich (45-82)\r\n  output$normal_distribution_bars <- renderUI({\r\n    # T-Werte von 45 bis 80 (realer Bereich laut Tabelle), alle 2er Schritte\r\n    # T=45 ist MINIMUM (12 Punkte), T=82 ist MAXIMUM (48 Punkte)\r\n    t_values <- seq(45, 79, by = 2)\r\n    \r\n    # Vordefinierte normalisierte HÃ¶hen fÃ¼r T=45-79 (basiert auf dnorm, dann skaliert)\r\n    # Peak bei T=50, abfallend zu den Seiten\r\n    heights <- c(\r\n      69, 80, 92, 105, 117, 129, 139, 148, 150, 148, 139, 129, 117, 105, 92, 80, 69, 55\r\n    )\r\n    \r\n    # Erstelle Balken\r\n    bars <- lapply(1:length(t_values), function(i) {\r\n      t_val <- t_values[i]\r\n      height <- heights[i]\r\n      \r\n      # Bestimme Farbe basierend auf T-Wert-Bereich\r\n      if (t_val <= 45) {\r\n        color <- \"#28a745\"  # GrÃ¼n\r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 55) {\r\n        color <- \"#17a2b8\"  # Blau  \r\n        opacity <- \"0.8\"\r\n      } else if (t_val <= 69) {\r\n        color <- \"#ffc107\"  # Gelb\r\n        opacity <- \"0.8\"\r\n      } else {\r\n        color <- \"#dc3545\"  # Rot\r\n        opacity <- \"0.8\"\r\n      }\r\n      \r\n      # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n      position <- 50 + ((t_val - 45) / 34) * 400\r\n      \r\n      div(style = paste0(\r\n        \"position: absolute; \",\r\n        \"left: \", position, \"px; \",\r\n        \"bottom: 25px; \",\r\n        \"width: 15px; \",\r\n        \"height: \", height, \"px; \",\r\n        \"background: \", color, \"; \",\r\n        \"border-radius: 2px 2px 0 0; \",\r\n        \"opacity: \", opacity, \"; \",\r\n        \"transition: all 0.3s ease;\"\r\n      ))\r\n    })\r\n    \r\n    return(tagList(bars))\r\n  })\r\n  \r\n  # Dynamische Positionierung des Benutzerwerts im Verteilungsdiagramm\r\n  output$user_position_marker <- renderUI({\r\n    if (!values$calculated) return(NULL)\r\n    \r\n    score <- values$total_score\r\n    t_val <- values$t_value\r\n    \r\n    # Position basierend auf T-Wert (45-79 auf 50px-450px mappen)\r\n    position <- 50 + ((t_val - 45) / 34) * 400\r\n    \r\n    # Begrenze Position auf sichtbare Bereiche\r\n    position <- max(50, min(450, position))\r\n    \r\n    tagList(\r\n      # Roter Strich\r\n      div(style = paste0(\"position: absolute; left: \", position, \"px; top: 10px; width: 4px; height: 180px; background: #ff0000; border-radius: 2px; box-shadow: 0 0 10px rgba(255,0,0,0.7); z-index: 10;\")),\r\n      # Pfeil nach unten\r\n      div(style = paste0(\"position: absolute; left: \", position-5, \"px; top: 185px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid #ff0000; z-index: 10;\")),\r\n      # Label\r\n      div(style = paste0(\"position: absolute; left: \", position-25, \"px; top: 200px; background: #ff0000; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap; z-index: 10;\"),\r\n          paste0(score, \" Pkt (T\", t_val, \")\")\r\n      )\r\n    )\r\n  })\r\n}\r\n\r\n# App starten\r\nshinyApp(ui = ui, server = server)","type":"text"}]
